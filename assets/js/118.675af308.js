(window.webpackJsonp=window.webpackJsonp||[]).push([[118],{571:function(t,a,e){"use strict";e.r(a);var s=e(3),r=Object(s.a)({},(function(){var t=this,a=t._self._c;return a("ContentSlotsDistributor",{attrs:{"slot-key":t.$parent.slotKey}},[a("h1",{attrs:{id:"docker使用"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#docker使用"}},[t._v("#")]),t._v(" docker使用")]),t._v(" "),a("p",[t._v("参考教程 "),a("a",{attrs:{href:"https://www.runoob.com/docker/docker-tutorial.html",target:"_blank",rel:"noopener noreferrer"}},[t._v("菜鸟 docker教程"),a("OutboundLink")],1)]),t._v(" "),a("h2",{attrs:{id:"安装"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#安装"}},[t._v("#")]),t._v(" 安装")]),t._v(" "),a("h3",{attrs:{id:"macos-docker-安装"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#macos-docker-安装"}},[t._v("#")]),t._v(" MacOS Docker 安装")]),t._v(" "),a("p",[a("a",{attrs:{href:"https://docs.docker.com/desktop/mac/install/",target:"_blank",rel:"noopener noreferrer"}},[t._v("docker 官网下载"),a("OutboundLink")],1)]),t._v(" "),a("p",[t._v("点击 "),a("code",[t._v("Mac with intel chip")]),t._v(" 按钮下载")]),t._v(" "),a("p",[t._v("如同 macOS 其它软件一样，安装也非常简单，双击下载的 .dmg 文件，然后将鲸鱼图标拖拽到 Application 文件夹即可。")]),t._v(" "),a("p",[t._v("从应用中找到 Docker 图标并点击运行。可能会询问 macOS 的登陆密码，输入即可。")]),t._v(" "),a("p",[t._v("启动终端后，通过命令可以检查安装后的 Docker 版本。")]),t._v(" "),a("div",{staticClass:"language-sh extra-class"},[a("pre",{pre:!0,attrs:{class:"language-sh"}},[a("code",[a("span",{pre:!0,attrs:{class:"token function"}},[t._v("docker")]),t._v(" --version\n")])])]),a("h3",{attrs:{id:"macos-docker-镜像加速"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#macos-docker-镜像加速"}},[t._v("#")]),t._v(" MacOS Docker 镜像加速")]),t._v(" "),a("p",[t._v("我们mac安装 docker 新版 2.2的时候，和菜鸟教程的版本不一样了。")]),t._v(" "),a("p",[a("a",{attrs:{href:"https://zhuanlan.zhihu.com/p/109485448",target:"_blank",rel:"noopener noreferrer"}},[t._v("MAC版 的最新Docker 2.2版本配置国内代理的解决办法"),a("OutboundLink")],1)]),t._v(" "),a("p",[t._v("Preferences（就是设置图标） -> Docker Engine")]),t._v(" "),a("p",[t._v("在输入框中加上")]),t._v(" "),a("div",{staticClass:"language-js extra-class"},[a("pre",{pre:!0,attrs:{class:"language-js"}},[a("code",[a("span",{pre:!0,attrs:{class:"token string-property property"}},[t._v('"registry-mirrors"')]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"https://docker.mirrors.ustc.edu.cn"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 中国某高等大学的")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"https://hub-mirror.c.163.com"')]),t._v(" "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 网易的")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v("\n")])])]),a("p",[t._v("点击按钮 "),a("code",[t._v("Apply & Restart")]),t._v(" 重启即可")]),t._v(" "),a("p",[t._v("在终端输入")]),t._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[t._v("docker info\n")])])]),a("p",[t._v("能看到")]),t._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",[a("code",[t._v("Registry Mirrors:\nhttps://docker.mirrors.ustc.edu.cn/\nhttps://hub-mirror.c.163.com/\n")])])]),a("p",[t._v("就是成功了")]),t._v(" "),a("h3",{attrs:{id:"centos-docker-安装"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#centos-docker-安装"}},[t._v("#")]),t._v(" CentOs Docker 安装")]),t._v(" "),a("p",[t._v("使用官方安装脚本自动安装")]),t._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[t._v("curl -fsSL https://get.docker.com | bash -s docker --mirror Aliyun\n")])])]),a("p",[t._v("启动 Docker。")]),t._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[t._v("sudo systemctl start docker\n")])])]),a("h3",{attrs:{id:"centos7-镜像加速"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#centos7-镜像加速"}},[t._v("#")]),t._v(" CentOS7 镜像加速")]),t._v(" "),a("p",[t._v("对于使用 systemd 的系统，请在 /etc/docker/daemon.json 中写入如下内容（如果文件不存在请新建该文件）：")]),t._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[t._v('{"registry-mirrors":["https://reg-mirror.qiniu.com/"]}\n')])])]),a("p",[t._v("之后重新启动服务：")]),t._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[t._v("sudo systemctl daemon-reload\nsudo systemctl restart docker\n")])])]),a("p",[a("code",[t._v("docker info")]),t._v(" 命令查看，结果内容中看到以下内容，说明配置成功。")]),t._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[t._v("Registry Mirrors:\n    https://reg-mirror.qiniu.com\n")])])]),a("h2",{attrs:{id:"docker-常用命令"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#docker-常用命令"}},[t._v("#")]),t._v(" docker 常用命令")]),t._v(" "),a("ul",[a("li",[a("code",[t._v("docker --version")]),t._v("      查看版本")]),t._v(" "),a("li",[a("code",[t._v("docker info")]),t._v("           查看配置信息")]),t._v(" "),a("li",[a("code",[t._v("docker pull [镜像地址]")]),t._v(" 下载镜像到本地")]),t._v(" "),a("li",[a("code",[t._v("docker images")]),t._v("         查看本地已安装的镜像\n"),a("ul",[a("li",[t._v("REPOSITORY：表示镜像的仓库源")]),t._v(" "),a("li",[t._v("TAG：       镜像的标签")]),t._v(" "),a("li",[t._v("IMAGE ID：  镜像ID")]),t._v(" "),a("li",[t._v("CREATED：   镜像创建时间")]),t._v(" "),a("li",[t._v("SIZE：      镜像大小")])])]),t._v(" "),a("li",[a("code",[t._v("docker build -t [镜像名称] .")]),t._v(" .是当前目录，根据当前目录的Dockerfile文件创建一个镜像")]),t._v(" "),a("li",[a("code",[t._v("docker rmi 镜像ID")]),t._v("  删除镜像")]),t._v(" "),a("li",[a("code",[t._v("docker ps")]),t._v("     查看每个容器的运行信息\n"),a("ul",[a("li",[t._v("CONTAINER ID: 容器 ID。\n"),a("ul",[a("li",[t._v("IMAGE:    使用的镜像。")]),t._v(" "),a("li",[t._v("COMMAND:  启动容器时运行的命令。")]),t._v(" "),a("li",[t._v("CREATED:  容器的创建时间。")]),t._v(" "),a("li",[t._v("STATUS:   容器状态，状态有7种：\n"),a("ul",[a("li",[t._v("created      （已创建）")]),t._v(" "),a("li",[t._v("restarting   （重启中）")]),t._v(" "),a("li",[t._v("running 或 Up（运行中）")]),t._v(" "),a("li",[t._v("removing     （迁移中）")]),t._v(" "),a("li",[t._v("paused       （暂停）")]),t._v(" "),a("li",[t._v("exited       （停止）")]),t._v(" "),a("li",[t._v("dead         （死亡）")]),t._v(" "),a("li",[t._v("PORTS: 容器的端口信息和使用的连接类型（tcp\\udp）。")]),t._v(" "),a("li",[t._v("NAMES: 自动分配的容器名称。")])])])])])])]),t._v(" "),a("li",[a("code",[t._v("docker ps -a")]),t._v("      查看每个容器（包括已经暂停的）的运行信息")]),t._v(" "),a("li",[a("code",[t._v("docker run -itd -p 8080:80 --name vueapp [镜像名称]")]),t._v(" 使用某个镜像启动一个容器， -d 后台开启")]),t._v(" "),a("li",[a("code",[t._v("docker stop [CONTAINER ID]")]),t._v(" 停止指定的容器")]),t._v(" "),a("li",[a("code",[t._v("docker start [CONTAINER ID]")]),t._v(" 启动指定的容器")]),t._v(" "),a("li",[a("code",[t._v("docker restart <容器 ID>")]),t._v("     重启指定的容器")]),t._v(" "),a("li",[a("code",[t._v("docker rm -f [CONTAINER ID]")]),t._v(" 删除指定的容器")]),t._v(" "),a("li",[a("code",[t._v("docker container prune")]),t._v("      删除掉所有处于终止状态的容器")]),t._v(" "),a("li",[a("code",[t._v("docker exec -it [容器 id] /bin/bash")]),t._v(" 进入容器( 要启动状态才能进入 )")]),t._v(" "),a("li",[a("code",[t._v("docker logs [CONTAINER ID]")]),t._v("  查看容器内的标准输出")]),t._v(" "),a("li",[a("code",[t._v("docker export [CONTAINER ID] > node.tar")]),t._v("  导出容器")]),t._v(" "),a("li",[a("code",[t._v("docker logout localhost:8080")]),t._v("   退出登录")]),t._v(" "),a("li",[a("code",[t._v("docker login --username=xxx --password=xxx registry.cn-shenzhen.aliyuncs.com")]),t._v(" 登录")]),t._v(" "),a("li",[a("code",[t._v("docker tag [ImageId] xxx/namespace/vueapp:[镜像版本号]")])])]),t._v(" "),a("h4",{attrs:{id:"批量操作"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#批量操作"}},[t._v("#")]),t._v(" 批量操作")]),t._v(" "),a("ul",[a("li",[a("code",[t._v("docker ps -aq")]),t._v("                  列出所有的容器 ID")]),t._v(" "),a("li",[a("code",[t._v("docker stop $(docker ps -aq)")]),t._v("   停止所有的容器")]),t._v(" "),a("li",[a("code",[t._v("docker rm $(docker ps -aq)")]),t._v("     删除所有的容器")]),t._v(" "),a("li",[a("code",[t._v("docker rmi $(docker images -q)")]),t._v(" 删除所有的镜像")]),t._v(" "),a("li",[a("code",[t._v("docker image prune --force --all")]),t._v("或者"),a("code",[t._v("docker image prune -f -a")]),t._v("  删除所有不使用的镜像")]),t._v(" "),a("li",[a("code",[t._v("docker container prune -f")]),t._v("      删除所有停止的容器")])]),t._v(" "),a("h2",{attrs:{id:"docker-容器的使用"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#docker-容器的使用"}},[t._v("#")]),t._v(" docker 容器的使用")]),t._v(" "),a("h3",{attrs:{id:"_1-先获取镜像"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_1-先获取镜像"}},[t._v("#")]),t._v(" 1. 先获取镜像")]),t._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[t._v("docker pull node\n")])])]),a("h3",{attrs:{id:"_2-启动容器"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_2-启动容器"}},[t._v("#")]),t._v(" 2. 启动容器")]),t._v(" "),a("p",[t._v("以下命令使用 node 镜像启动一个容器，参数为以命令行模式进入该容器：")]),t._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[t._v("docker run -it --name node-test node /bin/bash\n")])])]),a("p",[t._v("参数说明：")]),t._v(" "),a("ul",[a("li",[t._v("-i: 交互式操作。")]),t._v(" "),a("li",[t._v("-t: 终端。")]),t._v(" "),a("li",[t._v("node: node 镜像。")]),t._v(" "),a("li",[t._v("name: 自定义容器名称")]),t._v(" "),a("li",[t._v("/bin/bash：放在镜像名后的是命令，这里我们希望有个交互式 Shell，因此用的是 /bin/bash。")])]),t._v(" "),a("p",[t._v("要退出终端，直接输入 "),a("code",[t._v("exit")])]),t._v(" "),a("h3",{attrs:{id:"启动已停止运行的容器"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#启动已停止运行的容器"}},[t._v("#")]),t._v(" 启动已停止运行的容器")]),t._v(" "),a("p",[t._v("查看所有的容器命令如下：")]),t._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[t._v("docker ps -a\n")])])]),a("p",[t._v("使用 "),a("code",[t._v("docker start")]),t._v(" 启动一个已停止的容器：")]),t._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[t._v("docker start b750bbbcfd88 \n")])])]),a("h3",{attrs:{id:"后台运行容器"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#后台运行容器"}},[t._v("#")]),t._v(" 后台运行容器")]),t._v(" "),a("p",[t._v("在大部分的场景下，我们希望 docker 的服务是在后台运行的，我们可以过 "),a("code",[t._v("-d")]),t._v(" 指定容器的运行模式。")]),t._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[t._v("docker run -itd --name node-test node\n\n")])])]),a("p",[t._v("注：加了 "),a("code",[t._v("-d")]),t._v("参数默认不会进入容器，想要进入容器需要使用指令 "),a("code",[t._v("docker exec")]),t._v("（下面会介绍到）。")]),t._v(" "),a("h3",{attrs:{id:"进入容器"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#进入容器"}},[t._v("#")]),t._v(" 进入容器")]),t._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[t._v("docker exec -it [容器 id] /bin/bash\n")])])]),a("h3",{attrs:{id:"导出容器"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#导出容器"}},[t._v("#")]),t._v(" 导出容器")]),t._v(" "),a("p",[t._v("如果要导出本地某个容器，可以使用 docker export 命令。")]),t._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[t._v("docker export [容器 id] > node.tar\n")])])]),a("p",[t._v("这样将导出容器快照到本地文件。")]),t._v(" "),a("h3",{attrs:{id:"导入容器"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#导入容器"}},[t._v("#")]),t._v(" 导入容器")]),t._v(" "),a("h2",{attrs:{id:"docker-安装-centos"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#docker-安装-centos"}},[t._v("#")]),t._v(" Docker 安装 CentOS")]),t._v(" "),a("p",[t._v("1、查看可用的 CentOS 版本")]),t._v(" "),a("p",[t._v("访问 CentOS 镜像库地址："),a("a",{attrs:{href:"https://hub.docker.com/_/centos?tab=tags&page=1",target:"_blank",rel:"noopener noreferrer"}},[t._v("https://hub.docker.com/_/centos?tab=tags&page=1"),a("OutboundLink")],1),t._v("。")]),t._v(" "),a("p",[t._v("2、拉取指定版本的 CentOS 镜像，这里我们安装指定版本为例(centos7):")]),t._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[t._v("docker pull centos:centos7\n")])])]),a("p",[t._v("3、查看本地镜像")]),t._v(" "),a("p",[t._v("使用以下命令来查看是否已安装了 centos7：")]),t._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[t._v("docker images\n")])])]),a("p",[t._v("4、运行容器")]),t._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[t._v("docker run -itd --name centos-test centos:centos7\n")])])]),a("p",[t._v("5、 查看容器的运行信息")]),t._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[t._v("docker ps\n")])])]),a("p",[t._v("5、并且可以通过 exec 命令进入 CentOS 容器。(相当于进入 centOS 系统，想退出系统可以使用 exit)")]),t._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[t._v("docker exec -it centos-test /bin/bash\n")])])]),a("h2",{attrs:{id:"docker-安装-nginx"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#docker-安装-nginx"}},[t._v("#")]),t._v(" Docker 安装 Nginx")]),t._v(" "),a("p",[t._v("1、查看可用的 Nginx 版本")]),t._v(" "),a("p",[t._v("访问 Nginx 镜像库地址： "),a("a",{attrs:{href:"https://hub.docker.com/_/nginx?tab=tags",target:"_blank",rel:"noopener noreferrer"}},[t._v("https://hub.docker.com/_/nginx?tab=tags"),a("OutboundLink")],1),t._v("。")]),t._v(" "),a("p",[t._v("2、取最新版的 Nginx 镜像")]),t._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[t._v("docker pull nginx:latest\n")])])]),a("p",[t._v("3、查看本地镜像")]),t._v(" "),a("p",[t._v("使用以下命令来查看是否已安装了 nginx：")]),t._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[t._v("docker images\n")])])]),a("p",[t._v("4、运行容器")]),t._v(" "),a("p",[t._v("安装完成后，我们可以使用以下命令来运行 nginx 容器：")]),t._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[t._v("docker run --name nginx-test -p 8080:80 -d nginx\n")])])]),a("p",[t._v("参数说明：")]),t._v(" "),a("ul",[a("li",[t._v("--name nginx-test：容器名称。")]),t._v(" "),a("li",[t._v("-p 8080:80： 端口进行映射，将本地 8080 端口映射到容器内部的 80 端口。")]),t._v(" "),a("li",[t._v("-d nginx： 设置容器在在后台一直运行。")])]),t._v(" "),a("p",[t._v("5、最后我们可以通过浏览器可以直接访问 8080 端口的 nginx 服务：")]),t._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[t._v("localhost:8080\n")])])]),a("h2",{attrs:{id:"docker-安装-node-js"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#docker-安装-node-js"}},[t._v("#")]),t._v(" Docker 安装 Node.js")]),t._v(" "),a("p",[t._v("1、查看可用的 Node 版本")]),t._v(" "),a("p",[t._v("访问 Node 镜像库地址： "),a("a",{attrs:{href:"https://hub.docker.com/_/node?tab=tags",target:"_blank",rel:"noopener noreferrer"}},[t._v("https://hub.docker.com/_/node?tab=tags"),a("OutboundLink")],1)]),t._v(" "),a("p",[t._v("2、取最新版的 node 镜像")]),t._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[t._v("docker pull node:latest\n")])])]),a("p",[t._v("3、查看本地镜像")]),t._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[t._v("docker images\n")])])]),a("p",[t._v("4、运行容器")]),t._v(" "),a("p",[t._v("安装完成后，我们可以使用以下命令来运行 node 容器")]),t._v(" "),a("p",[t._v("参数说明：")]),t._v(" "),a("p",[t._v("--name node-test：容器名称。")]),t._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[t._v("docker run -itd --name node-test node\n")])])]),a("p",[t._v("5、最后进入查看容器运行的 node 版本:")]),t._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[t._v("docker exec -it node-test /bin/bash\n\nnode -v\n")])])]),a("h2",{attrs:{id:"dockerfile"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#dockerfile"}},[t._v("#")]),t._v(" Dockerfile")]),t._v(" "),a("p",[t._v("Dockerfile 是一个用来构建镜像的文本文件，文本内容包含了一条条构建镜像所需的指令和说明。")]),t._v(" "),a("ul",[a("li",[a("code",[t._v("FROM：")]),t._v("定制的镜像都是基于 FROM 的镜像，这里的 nginx 就是定制需要的"),a("code",[t._v("基础镜像")]),t._v("。后续的操作都是基于 nginx。")]),t._v(" "),a("li",[a("code",[t._v("RUN：")]),t._v("用于执行后面跟着的命令行命令。有以下俩种格式：")])]),t._v(" "),a("p",[t._v("shell 格式：")]),t._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[t._v("RUN <命令行命令>\n# <命令行命令> 等同于，在终端操作的 shell 命令。\n")])])]),a("p",[t._v("exec 格式：")]),t._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[t._v('RUN ["可执行文件", "参数1", "参数2"]\n# 例如：\n# RUN ["./test.php", "dev", "offline"] 等价于 RUN ./test.php dev offline\n')])])]),a("p",[t._v("注意：Dockerfile 的指令每执行一次都会在 docker 上新建一层。所以过多无意义的层，会造成镜像膨胀过大。例如：")]),t._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[t._v('FROM centos\nRUN yum install wget\nRUN wget -O redis.tar.gz "http://download.redis.io/releases/redis-5.0.3.tar.gz"\nRUN tar -xvf redis.tar.gz\n以上执行会创建 3 层镜像。可简化为以下格式：\nFROM centos\nRUN yum install wget \\\n    && wget -O redis.tar.gz "http://download.redis.io/releases/redis-5.0.3.tar.gz" \\\n    && tar -xvf redis.tar.gz\n')])])]),a("p",[t._v("如上，以 && 符号连接命令，这样执行后，只会创建 1 层镜像。")]),t._v(" "),a("h4",{attrs:{id:"创建镜像"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#创建镜像"}},[t._v("#")]),t._v(" 创建镜像")]),t._v(" "),a("p",[t._v("-t 是给镜像命名 . 是基于当前目录的Dockerfile来构建镜像")]),t._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[t._v("docker build -t vuenginxcontainer .\n")])])]),a("h4",{attrs:{id:"项目的dockerfile文件"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#项目的dockerfile文件"}},[t._v("#")]),t._v(" 项目的"),a("code",[t._v("Dockerfile")]),t._v("文件")]),t._v(" "),a("div",{staticClass:"language-js extra-class"},[a("pre",{pre:!0,attrs:{class:"language-js"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// Dockerfile")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token constant"}},[t._v("FROM")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token literal-property property"}},[t._v("node")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("14.15")]),a("span",{pre:!0,attrs:{class:"token number"}},[t._v(".3")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("as")]),t._v(" builder\n"),a("span",{pre:!0,attrs:{class:"token constant"}},[t._v("COPY")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v("app\n"),a("span",{pre:!0,attrs:{class:"token constant"}},[t._v("WORKDIR")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v("app\n"),a("span",{pre:!0,attrs:{class:"token constant"}},[t._v("RUN")]),t._v(" npm install "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("--")]),t._v("registry"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("https"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v("registry"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("npm"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("taobao"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("org\n"),a("span",{pre:!0,attrs:{class:"token constant"}},[t._v("RUN")]),t._v(" npm run build\n\n"),a("span",{pre:!0,attrs:{class:"token constant"}},[t._v("FROM")]),t._v(" nginx\n\n"),a("span",{pre:!0,attrs:{class:"token constant"}},[t._v("COPY")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("--")]),t._v("from"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("builder "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v("app"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v("dist "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v("usr"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v("share"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v("nginx"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v("html\n"),a("span",{pre:!0,attrs:{class:"token constant"}},[t._v("COPY")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("--")]),t._v("from"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("builder "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v("app"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v("nginx"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("default")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("conf "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v("etc"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v("nginx"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v("conf"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("d"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("default")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("conf\n"),a("span",{pre:!0,attrs:{class:"token constant"}},[t._v("CMD")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"nginx"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"-g"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"daemon off;"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v("\n")])])]),a("p",[t._v("我们来分析下上的代码：")]),t._v(" "),a("ul",[a("li",[a("p",[a("code",[t._v("FROM node:14.15.3 as builder")]),t._v("  安装使用node:14.15.3镜像，并给他应该别名 builder")])]),t._v(" "),a("li",[a("p",[a("code",[t._v("COPY . /app")]),t._v(" 拷贝当前目录所有文件，放到镜像的"),a("code",[t._v("/app")]),t._v("目录下，  "),a("code",[t._v(".")]),t._v("就是代表当前目录 "),a("code",[t._v("/app")]),t._v(" 代表在镜像上的目录路径")])]),t._v(" "),a("li",[a("p",[a("code",[t._v("WORKDIR /app")]),t._v(" 镜像内的工作目录是 "),a("code",[t._v("app")]),t._v("， 就是你使用命令进入镜像的时候，终端左边的目录就是"),a("code",[t._v("app")])])]),t._v(" "),a("li",[a("p",[a("code",[t._v("RUN npm install --registry=https://registry.npm.taobao.org")]),t._v(" "),a("code",[t._v("RUN")]),t._v("是执行命令，执行了后面的命令 npm install")])]),t._v(" "),a("li",[a("p",[a("code",[t._v("RUN npm run build")]),t._v(" 执行了 npm run build")])]),t._v(" "),a("li",[a("p",[a("code",[t._v("FROM nginx")]),t._v(" 安装使用nginx镜像")])]),t._v(" "),a("li",[a("p",[a("code",[t._v("COPY --from=builder /app/dist /usr/share/nginx/html")]),t._v("  --from=builder 是等待上面的安装完成后（也就是等 FROM nginx上面的命令都执行完之后，才执行） 注意，这里为什么要用 "),a("code",[t._v("/app/dist")]),t._v("， 因为上面上面设置了 "),a("code",[t._v("WORKDIR /app")]),t._v(", 然后我们 --from=builder 等待上面的命令生成，这时的镜像工作目录是"),a("code",[t._v("/app")]),t._v("，"),a("code",[t._v("/app")]),t._v("目录下已经有了dist文件夹内容，因为我们在镜像内执行了命令"),a("code",[t._v("npm run build")]),t._v("，所以我们可以直接从镜像的路径 "),a("code",[t._v("/app/dist")]),t._v(" 拷贝到 "),a("code",[t._v("/usr/share/nginx/html")])])]),t._v(" "),a("li",[a("p",[a("code",[t._v("COPY --from=builder /app/nginx/default.conf /etc/nginx/conf.d/default.conf")]),t._v(" 同上原理")])]),t._v(" "),a("li",[a("p",[a("code",[t._v('CMD ["nginx", "-g", "daemon off;"]')]),t._v(" 为了防止docker容器执行完命令挂掉（想了解更多，可以自行谷歌，也可以参考"),a("a",{attrs:{href:"https://segmentfault.com/a/1190000009583997",target:"_blank",rel:"noopener noreferrer"}},[t._v("docker运行nginx为什么要使用 daemon off"),a("OutboundLink")],1),t._v("）")])])]),t._v(" "),a("p",[t._v("由于我们上面用到了"),a("code",[t._v("nginx")]),t._v("，而且用到了 "),a("code",[t._v("/app/nginx/default.conf")]),t._v(" 路径")]),t._v(" "),a("p",[t._v("所以我们得在项目根目录新建个"),a("code",[t._v("nginx文件夹")]),t._v("，"),a("code",[t._v("nginx文件夹")]),t._v("里面新建个"),a("code",[t._v("default.conf文件")])]),t._v(" "),a("div",{staticClass:"language-js extra-class"},[a("pre",{pre:!0,attrs:{class:"language-js"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// default.conf")]),t._v("\nserver "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    listen       "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("80")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    server_name  localhost"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n    #charset koi8"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v("r"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    access_log  "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("var")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v("log"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v("nginx"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v("host"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("access"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("log  main"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    error_log  "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("var")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v("log"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v("nginx"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v("error"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("log  error"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n    location "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n        root   "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v("usr"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v("share"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v("nginx"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v("html"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n        index  index"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("html index"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("htm"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n\n    #error_page  "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("404")]),t._v("              "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("404")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("html"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n    # redirect server error pages to the "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("static")]),t._v(" page "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v("50x"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("html\n    #\n    error_page   "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("500")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("502")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("503")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("504")]),t._v("  "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v("50x"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("html"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    location "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v("50x"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("html "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n        root   "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v("usr"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v("share"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v("nginx"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v("html"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])]),a("p",[a("code",[t._v(".dockerignore")]),t._v(" 指定在传递给 docker引擎 时需要忽略掉的文件或文件夹。")]),t._v(" "),a("h2",{attrs:{id:"常见错误"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#常见错误"}},[t._v("#")]),t._v(" 常见错误")]),t._v(" "),a("h3",{attrs:{id:"上传自己的镜像被拒绝denied-requested-access-to-the-resource-is-denied"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#上传自己的镜像被拒绝denied-requested-access-to-the-resource-is-denied"}},[t._v("#")]),t._v(" 上传自己的镜像被拒绝denied: requested access to the resource is denied")]),t._v(" "),a("p",[t._v("信息显示是拒接访问，因为tag的名字斜线前面部分不是本人的用户名，下面把它修改为mydockerapp/xxxxx就push成功。需要注意的是mydockerapp是本人的docker用户名。进入docker hub网站查看，发现多了一个公共的repository。")]),t._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[t._v("docker login --username=xxx xxx.com\ndocker tag [ImageId] xxx/namespace/vueapp:[镜像版本号]\ndocker push xxx/namespace/vueapp:[镜像版本号]\n")])])])])}),[],!1,null,null,null);a.default=r.exports}}]);