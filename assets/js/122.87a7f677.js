(window.webpackJsonp=window.webpackJsonp||[]).push([[122],{576:function(s,t,a){"use strict";a.r(t);var e=a(3),r=Object(e.a)({},(function(){var s=this,t=s._self._c;return t("ContentSlotsDistributor",{attrs:{"slot-key":s.$parent.slotKey}},[t("h1",{attrs:{id:"项目中使用husky统一管理git-hooks-实现git-commit之前校验eslint"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#项目中使用husky统一管理git-hooks-实现git-commit之前校验eslint"}},[s._v("#")]),s._v(" 项目中使用husky统一管理git-hooks,实现git commit之前校验eslint")]),s._v(" "),t("p",[s._v("git hooks是一些自定义的脚本，用于控制git工作的流程，分为客户端钩子和服务端钩子。完整钩子说明，请参考"),t("a",{attrs:{href:"https://git-scm.com/docs/githooks",target:"_blank",rel:"noopener noreferrer"}},[s._v("官网链接"),t("OutboundLink")],1)]),s._v(" "),t("h2",{attrs:{id:"安装husky"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#安装husky"}},[s._v("#")]),s._v(" 安装husky")]),s._v(" "),t("div",{staticClass:"language- extra-class"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[s._v("npm install husky --save-dev\n")])])]),t("h2",{attrs:{id:"初始化husky"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#初始化husky"}},[s._v("#")]),s._v(" 初始化husky")]),s._v(" "),t("p",[s._v("方法一")]),s._v(" "),t("div",{staticClass:"language- extra-class"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[s._v("npx husky install\n")])])]),t("p",[s._v("在 "),t("code",[s._v("package.json")]),s._v(" 文件 添加下面命令")]),s._v(" "),t("div",{staticClass:"language-js extra-class"},[t("pre",{pre:!0,attrs:{class:"language-js"}},[t("code",[t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token literal-property property"}},[s._v("scripts")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token string-property property"}},[s._v('"prepare"')]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"husky install"')]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n")])])]),t("p",[s._v("方法二")]),s._v(" "),t("div",{staticClass:"language- extra-class"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[s._v("npm run prepare\n")])])]),t("p",[s._v("执行完上述安装命令后，将会发生如下几个变化：")]),s._v(" "),t("ul",[t("li",[s._v("在.git同级目录生成"),t("code",[s._v(".husky文件夹")]),s._v("，文件夹下有一个可以编辑的示例pre-commit钩子")]),s._v(" "),t("li",[s._v("在package.json中的scripts中添加了"),t("code",[s._v('"prepare": "husky install"')])]),s._v(" "),t("li",[s._v("更改.git文件下面的config文件，配置项 core."),t("code",[s._v("hooksPath")]),s._v(" 为 "),t("code",[s._v(".husky")])])]),s._v(" "),t("h2",{attrs:{id:"创建一个hook"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#创建一个hook"}},[s._v("#")]),s._v(" 创建一个hook")]),s._v(" "),t("p",[s._v("要添加另一个钩子，请使用husky add。")]),s._v(" "),t("div",{staticClass:"language- extra-class"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[s._v("npx husky add .husky/commit-msg 'npx --no-install commitlint --edit \"$1\"'\n")])])]),t("h2",{attrs:{id:"更新hooks脚本"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#更新hooks脚本"}},[s._v("#")]),s._v(" 更新hooks脚本")]),s._v(" "),t("p",[s._v("修改.husky文件夹下的hooks脚本即可。")]),s._v(" "),t("h2",{attrs:{id:"卸载并还原husky"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#卸载并还原husky"}},[s._v("#")]),s._v(" 卸载并还原husky")]),s._v(" "),t("div",{staticClass:"language- extra-class"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[s._v("npm uninstall husky\n// 删除.husky文件夹，并且重置core.hooksPath\nrm -rf .husky && git config --unset core.hooksPath\n")])])]),t("h2",{attrs:{id:"跳过hooks"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#跳过hooks"}},[s._v("#")]),s._v(" 跳过hooks")]),s._v(" "),t("p",[s._v("有时候我们因为一些原因，想绕过hooks检查，可通过下方命令实现：")]),s._v(" "),t("div",{staticClass:"language-js extra-class"},[t("pre",{pre:!0,attrs:{class:"language-js"}},[t("code",[s._v("git commit "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("m "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'xxx'")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("--")]),s._v("no"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("verify\n")])])]),t("h2",{attrs:{id:"实战"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#实战"}},[s._v("#")]),s._v(" 实战")]),s._v(" "),t("h3",{attrs:{id:"项目中commit的时候-校验eslint-警告和错误都不可以commit"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#项目中commit的时候-校验eslint-警告和错误都不可以commit"}},[s._v("#")]),s._v(" 项目中commit的时候，校验eslint, 警告和错误都不可以commit")]),s._v(" "),t("ol",[t("li",[s._v("安装好 husky 之后，创建个 pre-commit 的 gitHook")])]),s._v(" "),t("div",{staticClass:"language- extra-class"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[s._v("npx husky add .husky/pre-commit 'npm run lint'\n")])])]),t("ol",{attrs:{start:"2"}},[t("li",[s._v("安装lint-staged")])]),s._v(" "),t("div",{staticClass:"language- extra-class"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[s._v("npm install lint-staged --save-dev\n")])])]),t("p",[t("code",[s._v("lint-stated")]),s._v("就是针对Git暂存区的文件做校验的一个工具。由于在commit之前，我们要提交的文件是在暂存区的，我们可以利用这个工具来校验我们即将commit的文件，而不会校验其它的文件")]),s._v(" "),t("p",[s._v("配置lint-staged")]),s._v(" "),t("div",{staticClass:"language- extra-class"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[s._v('// package.json\n{\n    scripts: {\n        lint-staged: "lint-staged"\n    },\n    "lint-staged": {\n    "*.{js,vue}": [\n      "eslint --max-warnings 0"\n    ]\n  }\n}\n')])])]),t("p",[s._v("修改 .husky/"),t("code",[s._v("pre-push")]),s._v("文件")]),s._v(" "),t("div",{staticClass:"language- extra-class"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[s._v('#!/bin/sh\n. "$(dirname "$0")/_/husky.sh"\n\nnpm run lint-staged\n')])])]),t("p",[s._v("总结写流程： 我们提交 commit 的时候，触发了 "),t("code",[s._v("pre-push")]),s._v("的gitHook, 就执行了里面的脚本 "),t("code",[s._v("lint-staged")]),s._v(", 然后执行了 "),t("code",[s._v("eslint --max-warnings 0")]),s._v(", 最终eslint 0 警告 0 错误就可以commit成功，反之不行。")]),s._v(" "),t("p",[s._v("参考文章：")]),s._v(" "),t("p",[t("a",{attrs:{href:"https://juejin.cn/post/6974301879731748900",target:"_blank",rel:"noopener noreferrer"}},[s._v("详解如何在项目中使用git Hooks（husky、yorkie）"),t("OutboundLink")],1)])])}),[],!1,null,null,null);t.default=r.exports}}]);