(window.webpackJsonp=window.webpackJsonp||[]).push([[85],{539:function(t,s,a){"use strict";a.r(s);var r=a(3),e=Object(r.a)({},(function(){var t=this,s=t._self._c;return s("ContentSlotsDistributor",{attrs:{"slot-key":t.$parent.slotKey}},[s("h1",{attrs:{id:"package-json-与-package-lock-json-的关系"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#package-json-与-package-lock-json-的关系"}},[t._v("#")]),t._v(" package.json 与 package-lock.json 的关系")]),t._v(" "),s("p",[t._v("模块化开发在前端越来越流行，使用 node 和 npm 可以很方便的下载管理项目所需的依赖模块。"),s("strong",[s("code",[t._v("package.json 用来描述项目及项目所依赖的模块信息。")])])]),t._v(" "),s("p",[t._v("那 "),s("code",[t._v("package-lock.json")]),t._v(" 和 "),s("code",[t._v("package.json")]),t._v(" 有啥关系和联系呢？")]),t._v(" "),s("h2",{attrs:{id:"package-json"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#package-json"}},[t._v("#")]),t._v(" package.json")]),t._v(" "),s("h3",{attrs:{id:"管理包"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#管理包"}},[t._v("#")]),t._v(" 管理包")]),t._v(" "),s("p",[t._v("大家都知道，"),s("strong",[s("code",[t._v("package.json 用来描述项目及项目所依赖的模块信息。")])]),t._v("，就是帮我们管理项目中的依赖包的，让我们远离了依赖地狱。")]),t._v(" "),s("p",[t._v("通过 npm 管理，使用一些简单的命令，自动生成"),s("code",[t._v("package.json")]),t._v(", 安装包依赖关系都由"),s("code",[t._v("package.json")]),t._v("来管理，我们几乎不必考虑它们。")]),t._v(" "),s("h3",{attrs:{id:"语义版本控制"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#语义版本控制"}},[t._v("#")]),t._v(" 语义版本控制")]),t._v(" "),s("p",[t._v("首先我们先来了解下依赖包的"),s("strong",[t._v("版本号的定义")])]),t._v(" "),s("p",[t._v("版本号由三部分组成："),s("code",[t._v("major.minor.patch")]),t._v("，主版本号.次版本号.修补版本号。")]),t._v(" "),s("p",[t._v("例如：1.2.3，主要版本1，次要版本2，补丁3。")]),t._v(" "),s("ul",[s("li",[s("code",[t._v("补丁")]),t._v("中的更改表示不会破坏任何内容的错误修复。")]),t._v(" "),s("li",[s("code",[t._v("次要版本")]),t._v("的更改表示不会破坏任何内容的新功能。")]),t._v(" "),s("li",[s("code",[t._v("主要版本")]),t._v("的更改代表了一个破坏兼容性的大变化。 如果用户不适应主要版本更改，则内容将无法正常工作。")])]),t._v(" "),s("h3",{attrs:{id:"安装依赖包的版本如何指定"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#安装依赖包的版本如何指定"}},[t._v("#")]),t._v(" 安装依赖包的版本如何指定")]),t._v(" "),s("p",[t._v("相信大家都会经历过，我们安装一些依赖包的时候，版本号前面都会带 "),s("code",[t._v("^")]),t._v(" 或者 "),s("code",[t._v("~")]),t._v(" 的符号，这两个符号代表什么意思呢？")]),t._v(" "),s("p",[s("code",[t._v("~")]),t._v(" 会匹配最近的小版本依赖包，比如 ~1.2.3 会匹配所有 1.2.x 版本，但是不包括 1.3.0")]),t._v(" "),s("p",[s("code",[t._v("^")]),t._v(" 会匹配最新的大版本依赖包，比如 ^1.2.3 会匹配所有 1.x.x 的包，包括 1.3.0，但是不包括 2.0.0")]),t._v(" "),s("p",[s("code",[t._v("*")]),t._v(" 安装最新版本的依赖包，比如 *1.2.3 会匹配 x.x.x，")]),t._v(" "),s("p",[t._v("那么该如何选择呢？当然你可以"),s("code",[t._v("指定特定的版本号")]),t._v("，直接写1.2.3，前面"),s("strong",[t._v("什么前缀都没有")]),t._v("，这样固然没问题，但是如果依赖包发布新版本修复了一些小bug，那么需要手动修改package.json文件；"),s("code",[t._v("~")]),t._v(" 和 "),s("code",[t._v("^")]),t._v(" 则可以解决这个问题。")]),t._v(" "),s("p",[t._v("但是需要注意 ^ 版本更新可能比较大，会造成项目代码错误，所以 "),s("strong",[t._v("建议使用 "),s("code",[t._v("~")]),t._v(" 来标记版本号")]),t._v("，这样可以保证项目不会出现大的问题，也能保证包中的小bug可以得到修复。")]),t._v(" "),s("p",[t._v("版本号写 *，这意味着安装最新版本的依赖包，但缺点同上，可能会造成版本不兼容，"),s("b",{staticClass:"red"},[t._v("慎用！")])]),t._v(" "),s("h3",{attrs:{id:"多人开发时依赖包安装的问题"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#多人开发时依赖包安装的问题"}},[t._v("#")]),t._v(" 多人开发时依赖包安装的问题")]),t._v(" "),s("p",[t._v("看了上面版本号的指定后，我们可以知道，当我们使用了 "),s("code",[t._v("^")]),t._v(" 或者 "),s("code",[t._v("~")]),t._v(" 来控制依赖包版本号的时候 ，多人开发，就有可能存在大家安装的依赖包版本不一样的情况，就会存在项目运行的结果不一样。")]),t._v(" "),s("p",[s("strong",[t._v("我们举个例子：")])]),t._v(" "),s("p",[t._v("假设我们中安装了 "),s("code",[t._v("vue")]),t._v(", 当我们运行安装 "),s("code",[t._v("npm install vue -save")]),t._v(" 的时候，在项目中的package.json 的 vue 版本是  "),s("code",[t._v("vue: ^3.0.0")]),t._v(", 我们电脑安装的vue版本就是 3.0.0 版本，我们把项目代码提交后，过了一段时间，vue 发布了新版本 3.0.1，这时新来一个同事，从新 "),s("code",[t._v("git clone")]),t._v(" 克隆项目，执行 "),s("code",[t._v("npm install")]),t._v("安装的时候，在他电脑的vue版本就是 3.0.1了，因为^只是锁了主要版本，这样我们电脑中的vue版本就会不一样，"),s("strong",[t._v("从理论上讲（大家都遵循语义版本控制的话）")]),t._v("，它们应该仍然是兼容的，但也许 bugfix 会影响我们正在使用的功能，而且当使用vue版本3.0.0和3.0.1运行时，我们的应用程序会产生不同的结果。")]),t._v(" "),s("p",[t._v("大家思考思考，这样的话，不同人电脑安装的依赖版项目，是不是都有可能不一样，就会导致每个人电脑运行的应用程序产生不同的结果。就会存在bug的隐患。")]),t._v(" "),s("p",[t._v("这时也许有同学想到，那么我们在"),s("code",[t._v("package.json")]),t._v("上面锁死依赖包的版本号不就可以了? 直接写 "),s("code",[t._v("vue: 3.0.0")]),t._v("锁死，这样大家安装vue的版本都是3.0.0版本了。")]),t._v(" "),s("p",[t._v("这个想法固然是不错的，但是你只能控制你自己的项目锁死版本号，那你项目中依赖包的依赖包呢？你怎么控制限制别人锁死版本号呢？")]),t._v(" "),s("p",[t._v("为了解决这个不同人电脑安装的所有依赖版本都是一致的，确保项目代码在安装所执行的运行结果都一样，这时 "),s("code",[t._v("package-lock.json")]),t._v(" 就应运而生了。")]),t._v(" "),s("h2",{attrs:{id:"package-lock-json"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#package-lock-json"}},[t._v("#")]),t._v(" package-lock.json")]),t._v(" "),s("p",[t._v("package-lock.json 是在 npm(^5.x.x.x)后才有，中途有几次更改")]),t._v(" "),s("h3",{attrs:{id:"介绍"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#介绍"}},[t._v("#")]),t._v(" 介绍")]),t._v(" "),s("p",[s("a",{attrs:{href:"https://docs.npmjs.com/cli/v8/configuring-npm/package-lock-json",target:"_blank",rel:"noopener noreferrer"}},[t._v("官方文档"),s("OutboundLink")],1),t._v("是这样解释的："),s("code",[t._v("package-lock.json")]),t._v(" 它会"),s("strong",[t._v("在 npm 更改 node_modules 目录树 或者 package.json 时自动生成的")]),t._v(" ，它准确的描述了当前项目npm包的依赖树，并且在随后的安装中会根据 package-lock.json 来安装，保证是相同的一个依赖树，不考虑这个过程中是否有某个依赖有小版本的更新。")]),t._v(" "),s("p",[t._v("它的产生就是来对整个依赖树进行版本固定的（锁死）。")]),t._v(" "),s("p",[t._v("当我们在一个项目中"),s("code",[t._v("npm install")]),t._v("时候，会自动生成一个"),s("code",[t._v("package-lock.json")]),t._v("文件，和"),s("code",[t._v("package.json")]),t._v("在同一级目录下。"),s("code",[t._v("package-lock.json")]),t._v("记录了项目的一些信息和所依赖的模块。这样在每次安装都会出现相同的结果. 不管你在什么机器上面或什么时候安装。")]),t._v(" "),s("p",[t._v("当我们下次再"),s("code",[t._v("npm install")]),t._v("时候，npm 发现如果项目中有 "),s("code",[t._v("package-lock.json")]),t._v(" 文件，会根据 "),s("code",[t._v("package-lock.json")]),t._v(" 里的内容来处理和安装依赖而不再根据 "),s("code",[t._v("package.json")]),t._v("。")]),t._v(" "),s("blockquote",[s("p",[t._v("注意，使用"),s("code",[t._v("cnpm install")]),t._v("时候，并不会生成 "),s("code",[t._v("package-lock.json")]),t._v(" 文件，也不会根据 "),s("code",[t._v("package-lock.json")]),t._v(" 来安装依赖包，还是会使用 "),s("code",[t._v("package.json")]),t._v(" 来安装。")])]),t._v(" "),s("h3",{attrs:{id:"package-lock-json-生成逻辑"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#package-lock-json-生成逻辑"}},[t._v("#")]),t._v(" package-lock.json 生成逻辑")]),t._v(" "),s("p",[t._v("简单描述一下 "),s("code",[t._v("package-lock.json")]),t._v(" 生成的逻辑。假设我们现在有三个 package，在项目 lock-test中，安装依赖A，A项目面有B，B项目面有C")]),t._v(" "),s("div",{staticClass:"language-js extra-class"},[s("pre",{pre:!0,attrs:{class:"language-js"}},[s("code",[s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// package lock-test")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string-property property"}},[t._v('"name"')]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"lock-test"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string-property property"}},[t._v('"dependencies"')]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string-property property"}},[t._v('"A"')]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"^1.0.0"')]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// package A")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string-property property"}},[t._v('"name"')]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"A"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string-property property"}},[t._v('"version"')]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"1.0.0"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string-property property"}},[t._v('"dependencies"')]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string-property property"}},[t._v('"B"')]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"^1.0.0"')]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// package B")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string-property property"}},[t._v('"name"')]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"B"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string-property property"}},[t._v('"version"')]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"1.0.0"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string-property property"}},[t._v('"dependencies"')]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string-property property"}},[t._v('"C"')]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"^1.0.0"')]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// package C")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string-property property"}},[t._v('"name"')]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"C"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string-property property"}},[t._v('"version"')]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"1.0.0"')]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])]),s("p",[t._v("在这种情况下 "),s("code",[t._v("package-lock.json")]),t._v(", 会生成类似下面铺平的结构")]),t._v(" "),s("div",{staticClass:"language-js extra-class"},[s("pre",{pre:!0,attrs:{class:"language-js"}},[s("code",[s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// package-lock.json")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v(" \n    "),s("span",{pre:!0,attrs:{class:"token string-property property"}},[t._v('"name"')]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"lock-test"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("  \n    "),s("span",{pre:!0,attrs:{class:"token string-property property"}},[t._v('"version"')]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"1.0.0"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("  \n    "),s("span",{pre:!0,attrs:{class:"token string-property property"}},[t._v('"dependencies"')]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("    \n        "),s("span",{pre:!0,attrs:{class:"token string-property property"}},[t._v('"A"')]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string-property property"}},[t._v('"version"')]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"1.0.0"')]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n        "),s("span",{pre:!0,attrs:{class:"token string-property property"}},[t._v('"B"')]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string-property property"}},[t._v('"version"')]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"1.0.0"')]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n        "),s("span",{pre:!0,attrs:{class:"token string-property property"}},[t._v('"C"')]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string-property property"}},[t._v('"version"')]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"1.0.0"')]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("  \n    "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])]),s("p",[t._v("如果后续无论是直接依赖的 A 发版，或者间接依赖的B, C 发版，只要我们不动 "),s("code",[t._v("package.json")]),t._v(", "),s("code",[t._v("package-lock.json")]),t._v(" 都不会重新生成。")]),t._v(" "),s("p",[t._v("A 发布了新版本 1.1.0，虽然我们 package.json 写的是 ^1.0.0 但是因为 "),s("code",[t._v("package-lock.json")]),t._v(" 的存在，npm i 并不会自动升级，")]),t._v(" "),s("p",[t._v("我们可以手动运行 npm i A@1.1.0 来实现升级。")]),t._v(" "),s("p",[t._v("因为 1.1.0 "),s("code",[t._v("package-lock.json")]),t._v(" 里记录的 A@1.0.0 是不一致的，因此会更新 "),s("code",[t._v("package-lock.json")]),t._v(" 里的 A 的版本为 1.1.0。")]),t._v(" "),s("p",[t._v("B 发布了新版本 1.0.1, 1.0.2, 1.1.0, 此刻如果我们不做操作是不会自动升级 B 的版本的，但如果此刻 A 发布了 1.1.1，虽然并没有升级 B 的依赖，但是如果我们项目里升级 A@1.1.1，此时 "),s("code",[t._v("package-lock.json")]),t._v(" 里会把 B 直接升到 1.1.0 ,因为此刻^1.0.0的最新版本就是 1.1.0。")]),t._v(" "),s("p",[t._v("经过这些操作后 项目 lock-test 的 package.json 变成")]),t._v(" "),s("div",{staticClass:"language-js extra-class"},[s("pre",{pre:!0,attrs:{class:"language-js"}},[s("code",[s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// package ")]),t._v("\nlock"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v("test"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string-property property"}},[t._v('"dependencies"')]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string-property property"}},[t._v('"A"')]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"^1.1.0"')]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])]),s("p",[t._v("对应的 "),s("code",[t._v("package-lock.json")]),t._v(" 文件")]),t._v(" "),s("div",{staticClass:"language-js extra-class"},[s("pre",{pre:!0,attrs:{class:"language-js"}},[s("code",[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("  \n    "),s("span",{pre:!0,attrs:{class:"token string-property property"}},[t._v('"name"')]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"lock-test"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("  \n    "),s("span",{pre:!0,attrs:{class:"token string-property property"}},[t._v('"version"')]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"1.0.0"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token string-property property"}},[t._v('"dependencies"')]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("  \n        "),s("span",{pre:!0,attrs:{class:"token string-property property"}},[t._v('"A"')]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string-property property"}},[t._v('"version"')]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"1.1.0"')]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n        "),s("span",{pre:!0,attrs:{class:"token string-property property"}},[t._v('"B"')]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string-property property"}},[t._v('"version"')]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"1.1.0"')]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n        "),s("span",{pre:!0,attrs:{class:"token string-property property"}},[t._v('"C"')]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string-property property"}},[t._v('"version"')]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"1.0.0"')]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])]),s("p",[t._v("这个时候我们将 B 加入我们 lock-test 项目的依赖, B@^1.0.0，package.json如下")]),t._v(" "),s("div",{staticClass:"language-js extra-class"},[s("pre",{pre:!0,attrs:{class:"language-js"}},[s("code",[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string-property property"}},[t._v('"dependencies"')]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string-property property"}},[t._v('"A"')]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"^1.1.0"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string-property property"}},[t._v('"B"')]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"^1.0.0"')]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])]),s("p",[t._v("我们执行这个操作后，"),s("code",[t._v("package-lock.json")]),t._v(" 并没有被改变，因为现在 "),s("code",[t._v("package-lock.json")]),t._v(" 里 B@1.1.0 满足 ^1.0.0 的要求")]),t._v(" "),s("p",[t._v("但是如果我们将 B 的版本固定到 2.x 版本, "),s("code",[t._v("package-lock.json")]),t._v(" 就会发生改变")]),t._v(" "),s("div",{staticClass:"language-js extra-class"},[s("pre",{pre:!0,attrs:{class:"language-js"}},[s("code",[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string-property property"}},[t._v('"dependencies"')]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string-property property"}},[t._v('"A"')]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"^1.1.0"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string-property property"}},[t._v('"B"')]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"^2.0.0"')]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])]),s("p",[t._v("因为存在了两个冲突的B版本，"),s("code",[t._v("package-lock.json")]),t._v(" 文件会变成如下形式")]),t._v(" "),s("div",{staticClass:"language-js extra-class"},[s("pre",{pre:!0,attrs:{class:"language-js"}},[s("code",[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("  \n    "),s("span",{pre:!0,attrs:{class:"token string-property property"}},[t._v('"name"')]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"lock-test"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token string-property property"}},[t._v('"version"')]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"1.0.0"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("  \n    "),s("span",{pre:!0,attrs:{class:"token string-property property"}},[t._v('"dependencies"')]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("    \n        "),s("span",{pre:!0,attrs:{class:"token string-property property"}},[t._v('"A"')]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("      \n            "),s("span",{pre:!0,attrs:{class:"token string-property property"}},[t._v('"version"')]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"1.1.0"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("      \n            "),s("span",{pre:!0,attrs:{class:"token string-property property"}},[t._v('"dependencies"')]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("        \n                "),s("span",{pre:!0,attrs:{class:"token string-property property"}},[t._v('"B"')]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string-property property"}},[t._v('"version"')]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"1.1.0"')]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("      \n            "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("    \n        "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("    \n        "),s("span",{pre:!0,attrs:{class:"token string-property property"}},[t._v('"B"')]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string-property property"}},[t._v('"version"')]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"2.0.0"')]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("    \n        "),s("span",{pre:!0,attrs:{class:"token string-property property"}},[t._v('"C"')]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string-property property"}},[t._v('"version"')]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"1.0.0"')]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("  \n    "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])]),s("p",[t._v("因为 B 的版本出现了冲突，npm 使用嵌套描述了这种行为")]),t._v(" "),s("p",[t._v("我们实际开发中并不需要关注这种生成的算法逻辑，我们只需要了解，"),s("code",[t._v("package-lock.json")]),t._v(" 的生成逻辑是为了能够精准的反映出我们 node_modules 的结构，并保证能够这种结构被还原。")]),t._v(" "),s("h3",{attrs:{id:"package-lock-json-可能被意外更改的原因"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#package-lock-json-可能被意外更改的原因"}},[t._v("#")]),t._v(" package-lock.json 可能被意外更改的原因")]),t._v(" "),s("ol",[s("li",[s("p",[t._v("package.json 文件修改了")])]),t._v(" "),s("li",[s("p",[t._v("挪动了包的位置")])])]),t._v(" "),s("p",[t._v("将部分包的位置从 dependencies 移动到 devDependencies 这种操作，虽然包未变，但是也会影响 "),s("code",[t._v("package-lock.json")]),t._v("，会将部分包的 dev 字段设置为 true")]),t._v(" "),s("ol",{attrs:{start:"3"}},[s("li",[t._v("registry 的影响")])]),t._v(" "),s("p",[t._v("经过实际使用发现，如果我们 node_modules 文件夹下的包中下载时，就算版本一样，安装源 "),s("code",[t._v("registry")]),t._v(" 不同，执行 npm i 时也会修改 package-lock.json")]),t._v(" "),s("p",[t._v("可能还存在其他的原因，但是 "),s("code",[t._v("package-lock.json")]),t._v(" 是不会无缘无故被更改的，一定是因为 "),s("strong",[t._v("package.json 或者 node_modules 被更改了")]),t._v("，因为 正如上面提到的 package-lock.json 为了能够精准的反映出我们 node_modules 的结构")]),t._v(" "),s("h3",{attrs:{id:"开发的建议"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#开发的建议"}},[t._v("#")]),t._v(" 开发的建议")]),t._v(" "),s("p",[t._v("一般情况下 "),s("code",[t._v("npm install")]),t._v(" 是可以的，他能保证根据 "),s("code",[t._v("package-lock.json")]),t._v(" 还原出开发时的 "),s("code",[t._v("node_modules")]),t._v("。")]),t._v(" "),s("p",[t._v("但是为了防止出现刚刚提到的意外情况，除非涉及到对包的调整，其他情况下建议使用 "),s("code",[t._v("npm ci")]),t._v("来安装依赖，会避免异常的修改 "),s("code",[t._v("package-lock.json")]),t._v("，")]),t._v(" "),s("p",[t._v("持续集成工具中更推荐是用 "),s("code",[t._v("npm ci")]),t._v("，保证"),s("code",[t._v("构建环境的准确性")]),t._v("，"),s("strong",[t._v("npm i 和 npm ci 的区别")]),t._v(" 可以参考"),s("a",{attrs:{href:"https://docs.npmjs.com/cli/v8/commands/npm-ci",target:"_blank",rel:"noopener noreferrer"}},[t._v("官方文档 npm-ci"),s("OutboundLink")],1)]),t._v(" "),s("p",[t._v("参考文章：")]),t._v(" "),s("p",[s("a",{attrs:{href:"https://cloud.tencent.com/developer/article/1819632",target:"_blank",rel:"noopener noreferrer"}},[t._v("我的package-lock.json被谁改了？"),s("OutboundLink")],1)]),t._v(" "),s("p",[s("a",{attrs:{href:"https://www.zhihu.com/question/62331583/answer/275248129",target:"_blank",rel:"noopener noreferrer"}},[t._v("npm install 生成的package-lock.json是什么文件？有什么用？"),s("OutboundLink")],1)])])}),[],!1,null,null,null);s.default=e.exports}}]);