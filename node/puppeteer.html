<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>puppeteer | 阿离王-前端分享</title>
    <meta name="generator" content="VuePress 1.9.7">
    <link rel="icon" type="image/png" href="/myBlog/logo.jpg">
    <link rel="manifest" href="/myBlog/manifest.json">
    <link rel="stylesheet" href="https://at.alicdn.com/t/font_2343212_wc0gkht90m.css">
    <script src="https://cdn.jsdelivr.net/npm/react/umd/react.production.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/react-dom/umd/react-dom.production.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/vue/dist/vue.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/@babel/standalone/babel.min.js"></script>
    <script>
            // 百度统计
            var _hmt = _hmt || [];
            (function() {
                var hm = document.createElement("script");
                hm.src = "https://hm.baidu.com/hm.js?b867e5073a751b691958d2066964b07b";
                var s = document.getElementsByTagName("script")[0]; 
                s.parentNode.insertBefore(hm, s);
            })();
            
            // 引入谷歌统计,不需要可删除这段
            (function() {
                var hm1 = document.createElement("script");
                hm1.src = "https://www.googletagmanager.com/gtag/js?id=G-E76M3WVRT6";
                var s1 = document.getElementsByTagName("script")[0]; 
                s1.parentNode.insertBefore(hm1, s1);
            })();

            // 谷歌加载,不需要可删除
            window.dataLayer = window.dataLayer || [];
            function gtag(){dataLayer.push(arguments);}
            gtag('js', new Date());
          
            gtag('config', 'G-E76M3WVRT6');
        </script>
    <meta name="description" content="阿离王-前端分享笔记">
    
    <link rel="preload" href="/myBlog/assets/css/0.styles.a0db8047.css" as="style"><link rel="preload" href="/myBlog/assets/js/app.4ba5bfaa.js" as="script"><link rel="preload" href="/myBlog/assets/js/3.553f6c3a.js" as="script"><link rel="preload" href="/myBlog/assets/js/2.383a70a7.js" as="script"><link rel="preload" href="/myBlog/assets/js/80.c5e95066.js" as="script"><link rel="preload" href="/myBlog/assets/js/9.8651d337.js" as="script"><link rel="prefetch" href="/myBlog/assets/js/10.5667e96b.js"><link rel="prefetch" href="/myBlog/assets/js/100.026930ed.js"><link rel="prefetch" href="/myBlog/assets/js/101.5ed5da40.js"><link rel="prefetch" href="/myBlog/assets/js/102.a25fb263.js"><link rel="prefetch" href="/myBlog/assets/js/103.a37f7513.js"><link rel="prefetch" href="/myBlog/assets/js/104.219b2d0a.js"><link rel="prefetch" href="/myBlog/assets/js/105.29ed6eb0.js"><link rel="prefetch" href="/myBlog/assets/js/106.e65195bc.js"><link rel="prefetch" href="/myBlog/assets/js/107.74bd4e70.js"><link rel="prefetch" href="/myBlog/assets/js/108.bd9f41e6.js"><link rel="prefetch" href="/myBlog/assets/js/109.7020b196.js"><link rel="prefetch" href="/myBlog/assets/js/11.df2b365d.js"><link rel="prefetch" href="/myBlog/assets/js/110.b9b7891c.js"><link rel="prefetch" href="/myBlog/assets/js/111.10b9ede6.js"><link rel="prefetch" href="/myBlog/assets/js/112.0aa4be25.js"><link rel="prefetch" href="/myBlog/assets/js/113.504ade56.js"><link rel="prefetch" href="/myBlog/assets/js/114.67f6162c.js"><link rel="prefetch" href="/myBlog/assets/js/115.850eec11.js"><link rel="prefetch" href="/myBlog/assets/js/116.36ac05e1.js"><link rel="prefetch" href="/myBlog/assets/js/117.fe4b3847.js"><link rel="prefetch" href="/myBlog/assets/js/118.675af308.js"><link rel="prefetch" href="/myBlog/assets/js/119.091af631.js"><link rel="prefetch" href="/myBlog/assets/js/12.35990129.js"><link rel="prefetch" href="/myBlog/assets/js/120.786c198b.js"><link rel="prefetch" href="/myBlog/assets/js/121.f2bb35d4.js"><link rel="prefetch" href="/myBlog/assets/js/122.87a7f677.js"><link rel="prefetch" href="/myBlog/assets/js/123.c9c06d07.js"><link rel="prefetch" href="/myBlog/assets/js/124.ff8e36c9.js"><link rel="prefetch" href="/myBlog/assets/js/125.ade7d3b7.js"><link rel="prefetch" href="/myBlog/assets/js/126.28d9534e.js"><link rel="prefetch" href="/myBlog/assets/js/127.ec629aca.js"><link rel="prefetch" href="/myBlog/assets/js/128.54cbbb8d.js"><link rel="prefetch" href="/myBlog/assets/js/129.21b547da.js"><link rel="prefetch" href="/myBlog/assets/js/13.9d3248c2.js"><link rel="prefetch" href="/myBlog/assets/js/130.7493e162.js"><link rel="prefetch" href="/myBlog/assets/js/131.0b4819b9.js"><link rel="prefetch" href="/myBlog/assets/js/132.0e549cb5.js"><link rel="prefetch" href="/myBlog/assets/js/133.2f026438.js"><link rel="prefetch" href="/myBlog/assets/js/134.60f1b954.js"><link rel="prefetch" href="/myBlog/assets/js/135.ff2c35ec.js"><link rel="prefetch" href="/myBlog/assets/js/136.8c9cb988.js"><link rel="prefetch" href="/myBlog/assets/js/137.07a05e63.js"><link rel="prefetch" href="/myBlog/assets/js/138.cceee184.js"><link rel="prefetch" href="/myBlog/assets/js/139.9a7abcbc.js"><link rel="prefetch" href="/myBlog/assets/js/14.4672de5a.js"><link rel="prefetch" href="/myBlog/assets/js/140.0c420b5c.js"><link rel="prefetch" href="/myBlog/assets/js/141.773aac34.js"><link rel="prefetch" href="/myBlog/assets/js/142.ed70a961.js"><link rel="prefetch" href="/myBlog/assets/js/143.69e7f266.js"><link rel="prefetch" href="/myBlog/assets/js/144.6116ad52.js"><link rel="prefetch" href="/myBlog/assets/js/145.54b4c5d8.js"><link rel="prefetch" href="/myBlog/assets/js/146.d6b1ae16.js"><link rel="prefetch" href="/myBlog/assets/js/147.bfb7c815.js"><link rel="prefetch" href="/myBlog/assets/js/148.2467f5d2.js"><link rel="prefetch" href="/myBlog/assets/js/149.2a2a9bea.js"><link rel="prefetch" href="/myBlog/assets/js/15.c2538456.js"><link rel="prefetch" href="/myBlog/assets/js/150.bd0a44e6.js"><link rel="prefetch" href="/myBlog/assets/js/151.13fcb84d.js"><link rel="prefetch" href="/myBlog/assets/js/152.c5db66b0.js"><link rel="prefetch" href="/myBlog/assets/js/153.67626aff.js"><link rel="prefetch" href="/myBlog/assets/js/154.10b005b0.js"><link rel="prefetch" href="/myBlog/assets/js/155.7117978f.js"><link rel="prefetch" href="/myBlog/assets/js/156.0a66abbb.js"><link rel="prefetch" href="/myBlog/assets/js/157.f5e8dcd0.js"><link rel="prefetch" href="/myBlog/assets/js/158.f8bb2419.js"><link rel="prefetch" href="/myBlog/assets/js/159.15dfd559.js"><link rel="prefetch" href="/myBlog/assets/js/16.385c15b0.js"><link rel="prefetch" href="/myBlog/assets/js/160.20ab73fd.js"><link rel="prefetch" href="/myBlog/assets/js/17.509ad3af.js"><link rel="prefetch" href="/myBlog/assets/js/18.639170c9.js"><link rel="prefetch" href="/myBlog/assets/js/19.543102fe.js"><link rel="prefetch" href="/myBlog/assets/js/20.788bf6ff.js"><link rel="prefetch" href="/myBlog/assets/js/21.1b85b0e7.js"><link rel="prefetch" href="/myBlog/assets/js/22.dd82c6e4.js"><link rel="prefetch" href="/myBlog/assets/js/23.3257f308.js"><link rel="prefetch" href="/myBlog/assets/js/24.ff9c6dfc.js"><link rel="prefetch" href="/myBlog/assets/js/25.3d86ff9a.js"><link rel="prefetch" href="/myBlog/assets/js/26.fae4404f.js"><link rel="prefetch" href="/myBlog/assets/js/27.3e0c0eb0.js"><link rel="prefetch" href="/myBlog/assets/js/28.0d4cebfa.js"><link rel="prefetch" href="/myBlog/assets/js/29.78cb064f.js"><link rel="prefetch" href="/myBlog/assets/js/30.d705b76f.js"><link rel="prefetch" href="/myBlog/assets/js/31.2f82f12c.js"><link rel="prefetch" href="/myBlog/assets/js/32.74e35dfd.js"><link rel="prefetch" href="/myBlog/assets/js/33.dc9957cd.js"><link rel="prefetch" href="/myBlog/assets/js/34.a985534d.js"><link rel="prefetch" href="/myBlog/assets/js/35.35dd4d5a.js"><link rel="prefetch" href="/myBlog/assets/js/36.fa73c5b6.js"><link rel="prefetch" href="/myBlog/assets/js/37.7090639e.js"><link rel="prefetch" href="/myBlog/assets/js/38.b203cf72.js"><link rel="prefetch" href="/myBlog/assets/js/39.2a24ce59.js"><link rel="prefetch" href="/myBlog/assets/js/4.530d0f40.js"><link rel="prefetch" href="/myBlog/assets/js/40.48cb1685.js"><link rel="prefetch" href="/myBlog/assets/js/41.4e029f77.js"><link rel="prefetch" href="/myBlog/assets/js/42.faee5282.js"><link rel="prefetch" href="/myBlog/assets/js/43.3c22a644.js"><link rel="prefetch" href="/myBlog/assets/js/44.2c9eda87.js"><link rel="prefetch" href="/myBlog/assets/js/45.bd41351d.js"><link rel="prefetch" href="/myBlog/assets/js/46.6bbdd594.js"><link rel="prefetch" href="/myBlog/assets/js/47.11045cf9.js"><link rel="prefetch" href="/myBlog/assets/js/48.4c8082c3.js"><link rel="prefetch" href="/myBlog/assets/js/49.a3485775.js"><link rel="prefetch" href="/myBlog/assets/js/5.f156d2f9.js"><link rel="prefetch" href="/myBlog/assets/js/50.314b76f2.js"><link rel="prefetch" href="/myBlog/assets/js/51.6e15a4a1.js"><link rel="prefetch" href="/myBlog/assets/js/52.7eb9a211.js"><link rel="prefetch" href="/myBlog/assets/js/53.045eaf88.js"><link rel="prefetch" href="/myBlog/assets/js/54.6ac61812.js"><link rel="prefetch" href="/myBlog/assets/js/55.e0c4b4a3.js"><link rel="prefetch" href="/myBlog/assets/js/56.86f0472b.js"><link rel="prefetch" href="/myBlog/assets/js/57.9a314f24.js"><link rel="prefetch" href="/myBlog/assets/js/58.6137cb5a.js"><link rel="prefetch" href="/myBlog/assets/js/59.4199a1cf.js"><link rel="prefetch" href="/myBlog/assets/js/6.adba8f37.js"><link rel="prefetch" href="/myBlog/assets/js/60.f7e365c9.js"><link rel="prefetch" href="/myBlog/assets/js/61.5d431bb9.js"><link rel="prefetch" href="/myBlog/assets/js/62.78679706.js"><link rel="prefetch" href="/myBlog/assets/js/63.58209586.js"><link rel="prefetch" href="/myBlog/assets/js/64.cecf37d3.js"><link rel="prefetch" href="/myBlog/assets/js/65.9bb63e23.js"><link rel="prefetch" href="/myBlog/assets/js/66.5001470c.js"><link rel="prefetch" href="/myBlog/assets/js/67.502be0ae.js"><link rel="prefetch" href="/myBlog/assets/js/68.850b0d7d.js"><link rel="prefetch" href="/myBlog/assets/js/69.a125fcb7.js"><link rel="prefetch" href="/myBlog/assets/js/7.381ca64b.js"><link rel="prefetch" href="/myBlog/assets/js/70.84b8a555.js"><link rel="prefetch" href="/myBlog/assets/js/71.ef39a00e.js"><link rel="prefetch" href="/myBlog/assets/js/72.de23d741.js"><link rel="prefetch" href="/myBlog/assets/js/73.7952e9da.js"><link rel="prefetch" href="/myBlog/assets/js/74.ebbc77e1.js"><link rel="prefetch" href="/myBlog/assets/js/75.046c75a5.js"><link rel="prefetch" href="/myBlog/assets/js/76.0aeca334.js"><link rel="prefetch" href="/myBlog/assets/js/77.0d440ed9.js"><link rel="prefetch" href="/myBlog/assets/js/78.2434dedb.js"><link rel="prefetch" href="/myBlog/assets/js/79.29f4f329.js"><link rel="prefetch" href="/myBlog/assets/js/8.c5336147.js"><link rel="prefetch" href="/myBlog/assets/js/81.75fc2091.js"><link rel="prefetch" href="/myBlog/assets/js/82.e82c92fb.js"><link rel="prefetch" href="/myBlog/assets/js/83.4c52114d.js"><link rel="prefetch" href="/myBlog/assets/js/84.1726c5eb.js"><link rel="prefetch" href="/myBlog/assets/js/85.f2010794.js"><link rel="prefetch" href="/myBlog/assets/js/86.51c645b1.js"><link rel="prefetch" href="/myBlog/assets/js/87.255b1853.js"><link rel="prefetch" href="/myBlog/assets/js/88.5eb49ebc.js"><link rel="prefetch" href="/myBlog/assets/js/89.823afe40.js"><link rel="prefetch" href="/myBlog/assets/js/90.97e08560.js"><link rel="prefetch" href="/myBlog/assets/js/91.6d85d206.js"><link rel="prefetch" href="/myBlog/assets/js/92.3e9327c8.js"><link rel="prefetch" href="/myBlog/assets/js/93.aa1520cd.js"><link rel="prefetch" href="/myBlog/assets/js/94.75b55830.js"><link rel="prefetch" href="/myBlog/assets/js/95.84080a60.js"><link rel="prefetch" href="/myBlog/assets/js/96.3c8eaa6f.js"><link rel="prefetch" href="/myBlog/assets/js/97.ac859fc6.js"><link rel="prefetch" href="/myBlog/assets/js/98.7694e2bb.js"><link rel="prefetch" href="/myBlog/assets/js/99.83760907.js">
    <link rel="stylesheet" href="/myBlog/assets/css/0.styles.a0db8047.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/myBlog/" class="home-link router-link-active"><img src="/myBlog/assets/img/logo.jpg" alt="阿离王-前端分享" class="logo"> <span class="site-name can-hide">阿离王-前端分享</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/myBlog/" class="nav-link">
  首页
</a></div><div class="nav-item"><a href="/myBlog/about.html" class="nav-link">
  关于我
</a></div><div class="nav-item"><a href="http://ebook.wanggege.cn/" target="_blank" rel="noopener noreferrer" class="nav-link external">
  前端基础电子书
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div> <a href="https://github.com/347830076/" target="_blank" rel="noopener noreferrer" class="repo-link">
    GitHub
    <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/myBlog/" class="nav-link">
  首页
</a></div><div class="nav-item"><a href="/myBlog/about.html" class="nav-link">
  关于我
</a></div><div class="nav-item"><a href="http://ebook.wanggege.cn/" target="_blank" rel="noopener noreferrer" class="nav-link external">
  前端基础电子书
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div> <a href="https://github.com/347830076/" target="_blank" rel="noopener noreferrer" class="repo-link">
    GitHub
    <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></nav>  <ul class="sidebar-links"><li><a href="/myBlog/" aria-current="page" class="sidebar-link">首页</a></li><li><section class="sidebar-group collapsable depth-0"><a href="/myBlog/css/" class="sidebar-heading clickable"><span>css</span> <span class="arrow right"></span></a> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><a href="/myBlog/javascript/" class="sidebar-heading clickable"><span>javascript</span> <span class="arrow right"></span></a> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>typescript</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>Vue</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><a href="/myBlog/react/" class="sidebar-heading clickable"><span>react</span> <span class="arrow right"></span></a> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><a href="/myBlog/components/" class="sidebar-heading clickable"><span>组件使用教程</span> <span class="arrow right"></span></a> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading open"><span>node技巧</span> <span class="arrow down"></span></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/myBlog/node/配置全局命令.html" class="sidebar-link">node设置全局命令</a></li><li><a href="/myBlog/node/前端路由Nginx配置.html" class="sidebar-link">前端路由 Nginx 配置</a></li><li><a href="/myBlog/node/Nginx配置密码访问.html" class="sidebar-link">Nginx配置密码访问网页</a></li><li><a href="/myBlog/node/Nginx反向代理配置.html" class="sidebar-link">Nginx 反向代理配置</a></li><li><a href="/myBlog/node/centos添加用户并设置免密登录.html" class="sidebar-link">centos添加用户并设置免密登录</a></li><li><a href="/myBlog/node/linux-expect.html" class="sidebar-link">Linux expect 介绍和用法</a></li><li><a href="/myBlog/node/centos安装软件问题.html" class="sidebar-link">centos安装软件问题</a></li><li><a href="/myBlog/node/forever.html" class="sidebar-link">Node 服务管理模块 forever</a></li><li><a href="/myBlog/node/pm2.html" class="sidebar-link">PM2 命令使用方法</a></li><li><a href="/myBlog/node/puppeteer.html" aria-current="page" class="active sidebar-link">puppeteer</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/myBlog/node/puppeteer.html#能做什么呢" class="sidebar-link">能做什么呢？</a></li><li class="sidebar-sub-header"><a href="/myBlog/node/puppeteer.html#安装" class="sidebar-link">安装</a></li><li class="sidebar-sub-header"><a href="/myBlog/node/puppeteer.html#操作浏览器" class="sidebar-link">操作浏览器</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/myBlog/node/puppeteer.html#启动浏览器" class="sidebar-link">启动浏览器</a></li><li class="sidebar-sub-header"><a href="/myBlog/node/puppeteer.html#有头-headful-模式" class="sidebar-link">有头(headful)模式</a></li><li class="sidebar-sub-header"><a href="/myBlog/node/puppeteer.html#调试" class="sidebar-link">调试</a></li></ul></li><li class="sidebar-sub-header"><a href="/myBlog/node/puppeteer.html#页面操作" class="sidebar-link">页面操作</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/myBlog/node/puppeteer.html#访问网站" class="sidebar-link">访问网站</a></li><li class="sidebar-sub-header"><a href="/myBlog/node/puppeteer.html#设备模拟" class="sidebar-link">设备模拟</a></li><li class="sidebar-sub-header"><a href="/myBlog/node/puppeteer.html#事件处理" class="sidebar-link">事件处理</a></li><li class="sidebar-sub-header"><a href="/myBlog/node/puppeteer.html#鼠标模拟" class="sidebar-link">鼠标模拟</a></li><li class="sidebar-sub-header"><a href="/myBlog/node/puppeteer.html#键盘模拟" class="sidebar-link">键盘模拟</a></li><li class="sidebar-sub-header"><a href="/myBlog/node/puppeteer.html#截屏" class="sidebar-link">截屏</a></li><li class="sidebar-sub-header"><a href="/myBlog/node/puppeteer.html#生成pdf" class="sidebar-link">生成PDF</a></li><li class="sidebar-sub-header"><a href="/myBlog/node/puppeteer.html#地理位置模拟" class="sidebar-link">地理位置模拟</a></li><li class="sidebar-sub-header"><a href="/myBlog/node/puppeteer.html#阻止javascript" class="sidebar-link">阻止Javascript</a></li><li class="sidebar-sub-header"><a href="/myBlog/node/puppeteer.html#获取页面源代码" class="sidebar-link">获取页面源代码</a></li><li class="sidebar-sub-header"><a href="/myBlog/node/puppeteer.html#可访问性-accessibility" class="sidebar-link">可访问性(Accessibility)</a></li><li class="sidebar-sub-header"><a href="/myBlog/node/puppeteer.html#代码覆盖率" class="sidebar-link">代码覆盖率</a></li><li class="sidebar-sub-header"><a href="/myBlog/node/puppeteer.html#性能评估" class="sidebar-link">性能评估</a></li></ul></li></ul></li></ul></section></li><li><section class="sidebar-group collapsable depth-0"><a href="/myBlog/npm/" class="sidebar-heading clickable"><span>npm</span> <span class="arrow right"></span></a> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>工具栏</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>规范</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>资源分享</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>实用例子</span> <span class="arrow right"></span></p> <!----></section></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="puppeteer"><a href="#puppeteer" class="header-anchor">#</a> puppeteer</h1> <p><a href="https://pptr.dev/" target="_blank" rel="noopener noreferrer">Puppeteer<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> 是一个 Node.js 库，它提供了一个高级 API 来通过 DevTools Protocol控制 Chrome/Chromium 。</p> <p>简单来说，就是puppeteer提供api给我们可以在服务器打开浏览器，然后操作浏览器。</p> <p><a href="https://puppeteer.bootcss.com/" target="_blank" rel="noopener noreferrer">Puppeteer 中文文档<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p> <h2 id="能做什么呢"><a href="#能做什么呢" class="header-anchor">#</a> 能做什么呢？</h2> <p>大多数您可以在浏览器中手动完成的事情都可以使用 Puppeteer 完成！以下是一些帮助您入门的示例：</p> <ul><li>生成页面的屏幕截图和 PDF。</li> <li>抓取 SPA（单页应用程序）并生成预渲染内容（即“SSR”（服务器端渲染））。</li> <li>自动化表单提交、UI 测试、键盘输入，鼠标模拟等。</li> <li>使用最新的 JavaScript 和浏览器功能创建自动化测试环境。</li> <li>捕获站点的 时间线跟踪 以帮助诊断性能问题。</li> <li>测试 Chrome 扩展。</li></ul> <h2 id="安装"><a href="#安装" class="header-anchor">#</a> 安装</h2> <p>Puppeteer 有2种包可以安装：</p> <ul><li>puppeteer-core 核心api包，不下载chrome浏览器，不支持PUPPETEER_* 系列环境变量</li> <li>puppeteer 安装时下载chrome浏览器</li></ul> <p>在大多数情况下，你可以使用 puppeteer 包。</p> <p>然而, 如果是下面这些情况那你需要使用 puppeteer-core:</p> <p>你正在构建 DevTools 协议顶部的另一个最终用户产品或库。例如，可以使用 puppeteer-core 构建 PDF 生成器并编写下载 headless_shell 的自定义install.js脚本而不是 Chromium 来节省磁盘空间。</p> <p>你正在打包 Puppeteer 用在 Chrome 扩展应用或浏览器中以使用 DevTools 协议，因为下载额外的 Chromium 二进制文件不是必须的。</p> <div class="language- extra-class"><pre class="language-text"><code>npm i puppeteer
</code></pre></div><div class="language- extra-class"><pre class="language-text"><code>npm install puppeteer-core
</code></pre></div><h2 id="操作浏览器"><a href="#操作浏览器" class="header-anchor">#</a> 操作浏览器</h2> <h3 id="启动浏览器"><a href="#启动浏览器" class="header-anchor">#</a> 启动浏览器</h3> <p>要启动Chrome浏览器，可以使用<code>puppeteer</code>的<code>launch</code>方法:</p> <p>创建 app.js 文件，写如下代码：</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// app.js</span>
<span class="token keyword">const</span> puppeteer <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'puppeteer'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token punctuation">(</span><span class="token keyword">async</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> browser <span class="token operator">=</span> <span class="token keyword">await</span> puppeteer<span class="token punctuation">.</span><span class="token function">launch</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  console<span class="token punctuation">.</span><span class="token function">info</span><span class="token punctuation">(</span>browser<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">await</span> browser<span class="token punctuation">.</span><span class="token function">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

</code></pre></div><p>然后通过node 执行 app.js文件</p> <div class="language-js extra-class"><pre class="language-js"><code>node app<span class="token punctuation">.</span>js
</code></pre></div><p>可以看到控制台打印了 browser 信息了</p> <h3 id="有头-headful-模式"><a href="#有头-headful-模式" class="header-anchor">#</a> 有头(headful)模式</h3> <p>Puppeteer中，浏览器默认是在无头(headless)模式下启动的，无头(headless)模式只使用命令行，不显示图形界面</p> <p>而有头(headful)模式会在执行期间打开浏览器图形界面</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">const</span> puppeteer <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'puppeteer'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token punctuation">(</span><span class="token keyword">async</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token comment">// 让浏览器以有头(headful)模式启动</span>
  <span class="token keyword">const</span> browser <span class="token operator">=</span> <span class="token keyword">await</span> puppeteer<span class="token punctuation">.</span><span class="token function">launch</span><span class="token punctuation">(</span><span class="token punctuation">{</span> <span class="token literal-property property">headless</span><span class="token operator">:</span> <span class="token boolean">false</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  console<span class="token punctuation">.</span><span class="token function">info</span><span class="token punctuation">(</span>browser<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">await</span> browser<span class="token punctuation">.</span><span class="token function">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>无头(headless)模式对于不需要UI或者不支持图形界面的环境非常有用；而有头(headful)模式则会让我们清楚地看到执行详情。</p> <h3 id="调试"><a href="#调试" class="header-anchor">#</a> 调试</h3> <h4 id="查看浏览器的执行"><a href="#查看浏览器的执行" class="header-anchor">#</a> 查看浏览器的执行</h4> <p>puppeteer脚本执行时，可以查看浏览器的执行和界面显示情况。</p> <p>puppeteer有头(headful)模式会显示浏览器界面，设置<code>slwMo</code>参数可以减慢puppeteer执行每个操作时的速度。</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">const</span> puppeteer <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'puppeteer'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token punctuation">(</span><span class="token keyword">async</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> browser <span class="token operator">=</span> <span class="token keyword">await</span> puppeteer<span class="token punctuation">.</span><span class="token function">launch</span><span class="token punctuation">(</span><span class="token punctuation">{</span> <span class="token literal-property property">headless</span><span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span> <span class="token literal-property property">slowMo</span><span class="token operator">:</span> <span class="token number">200</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token comment">// 浏览器操作</span>

  <span class="token keyword">await</span> browser<span class="token punctuation">.</span><span class="token function">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h4 id="在浏览器中调试应用程序代码"><a href="#在浏览器中调试应用程序代码" class="header-anchor">#</a> 在浏览器中调试应用程序代码</h4> <p>puppeteer有头(headful)模式会显示浏览器界面，可以使用DevTools调试应用程序本身。</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">const</span> puppeteer <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'puppeteer'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token punctuation">(</span><span class="token keyword">async</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> browser <span class="token operator">=</span> <span class="token keyword">await</span> puppeteer<span class="token punctuation">.</span><span class="token function">launch</span><span class="token punctuation">(</span><span class="token punctuation">{</span> <span class="token literal-property property">devtools</span><span class="token operator">:</span> <span class="token boolean">true</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token comment">// 浏览器操作</span>

  <span class="token comment">// 保持浏览器打开，直到显式终止进程</span>
  <span class="token keyword">await</span> browser<span class="token punctuation">.</span><span class="token function">waitForTarget</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token keyword">await</span> browser<span class="token punctuation">.</span><span class="token function">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>puppeteer启动时，设置<code>devtools: true</code>，默认情况下会以有头(headful)模式启动浏览器，并自动打开devtools。</p> <p>使用<code>waitForTarget</code>来保留浏览器进程，直到浏览器被显式关闭(控制台退出)。</p> <p>要让浏览器休眠一段时间，可以使用：</p> <ul><li><code>setTimeout</code>方法</li></ul> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">const</span> puppeteer <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'puppeteer'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token punctuation">(</span><span class="token keyword">async</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> browser <span class="token operator">=</span> <span class="token keyword">await</span> puppeteer<span class="token punctuation">.</span><span class="token function">launch</span><span class="token punctuation">(</span><span class="token punctuation">{</span> <span class="token literal-property property">devtools</span><span class="token operator">:</span> <span class="token boolean">true</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token comment">// 浏览器操作</span>

  <span class="token comment">// 创建空白页(新选项卡)</span>
  <span class="token keyword">const</span> page <span class="token operator">=</span> <span class="token keyword">await</span> browser<span class="token punctuation">.</span><span class="token function">newPage</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token keyword">await</span> page<span class="token punctuation">.</span><span class="token function">goto</span><span class="token punctuation">(</span><span class="token string">'https://www.infobyip.com'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'加载完页面'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token comment">// 在“setTimeout”结束时resolve一个承诺</span>
  <span class="token keyword">const</span> <span class="token function-variable function">sleep</span> <span class="token operator">=</span> <span class="token parameter">duration</span> <span class="token operator">=&gt;</span> <span class="token keyword">new</span> <span class="token class-name">Promise</span><span class="token punctuation">(</span><span class="token parameter">resolve</span> <span class="token operator">=&gt;</span> <span class="token function">setTimeout</span><span class="token punctuation">(</span>resolve<span class="token punctuation">,</span> duration<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">await</span> <span class="token function">sleep</span><span class="token punctuation">(</span><span class="token number">3000</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'3秒后打印'</span><span class="token punctuation">)</span>

  <span class="token keyword">await</span> browser<span class="token punctuation">.</span><span class="token function">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h4 id="调试puppeteer脚本的执行进程"><a href="#调试puppeteer脚本的执行进程" class="header-anchor">#</a> 调试Puppeteer脚本的执行进程</h4> <p>Puppeteer脚本是在Node.js进程中执行的，与浏览器进程完全分离。因此，可以像调试常规Node.js应用程序一样调试Puppeteer脚本。</p> <h4 id="node-inspect-命令行调试"><a href="#node-inspect-命令行调试" class="header-anchor">#</a> node inspect 命令行调试</h4> <p>例如，在命令行中，可以使用<code>node inspect &lt;脚本文件&gt;</code>调试脚本：</p> <div class="language-js extra-class"><pre class="language-js"><code>node inspect app<span class="token punctuation">.</span>js
</code></pre></div><p>可以输入<code>help</code>查看调试命令：</p> <div class="language- extra-class"><pre class="language-text"><code>debug&gt; help

run, restart, r       Run the application or reconnect
kill                  Kill a running application or disconnect

cont, c               Resume execution
next, n               Continue to next line in current file
step, s               Step into, potentially entering a function
out, o                Step out, leaving the current function
backtrace, bt         Print the current backtrace
list                  Print the source around the current line where execution
                      is currently paused

setBreakpoint, sb     Set a breakpoint
clearBreakpoint, cb   Clear a breakpoint
breakpoints           List all known breakpoints
breakOnException      Pause execution whenever an exception is thrown
breakOnUncaught       Pause execution whenever an exception isn't caught
breakOnNone           Don't pause on exceptions (this is the default)

watch(expr)           Start watching the given expression
unwatch(expr)         Stop watching an expression
watchers              Print all watched expressions and their current values

exec(expr)            Evaluate the expression and print the value
repl                  Enter a debug repl that works like exec

scripts               List application scripts that are currently loaded
scripts(true)         List all scripts (including node-internals)

profile               Start CPU profiling session.
profileEnd            Stop current CPU profiling session.
profiles              Array of completed CPU profiling sessions.
profiles[n].save(filepath = 'node.cpuprofile')
                      Save CPU profiling session to disk as JSON.

takeHeapSnapshot(filepath = 'node.heapsnapshot')
                      Take a heap snapshot and save to disk as JSON.
</code></pre></div><h4 id="node-inspect-图形界面调试-vs-code"><a href="#node-inspect-图形界面调试-vs-code" class="header-anchor">#</a> node inspect 图形界面调试(VS code)</h4> <p>VS code 已经对node inspect做了很好的集成，使用起来很方便：</p> <ol><li>点击Debug按钮，添加调试配置，如下图所示：</li></ol> <img src="https://qiniu.wanggege.cn/blog/puppeteer/debug1.png" class="zoom-custom-imgs"> <ol start="2"><li>启动调试</li></ol> <p>如下图所示，先设置断点，然后启动调试：</p> <img src="https://qiniu.wanggege.cn/blog/puppeteer/debug2.png" class="zoom-custom-imgs"> <h2 id="页面操作"><a href="#页面操作" class="header-anchor">#</a> 页面操作</h2> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">const</span> puppeteer <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'puppeteer'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token punctuation">(</span><span class="token keyword">async</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> browser <span class="token operator">=</span> <span class="token keyword">await</span> puppeteer<span class="token punctuation">.</span><span class="token function">launch</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token comment">// 在默认浏览器环境中创建一个新页面</span>
  <span class="token keyword">const</span> page <span class="token operator">=</span> <span class="token keyword">await</span> browser<span class="token punctuation">.</span><span class="token function">newPage</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  console<span class="token punctuation">.</span><span class="token function">info</span><span class="token punctuation">(</span>page<span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token keyword">await</span> browser<span class="token punctuation">.</span><span class="token function">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>如上所示，调用newPage方法创建了一个新页面，注意，该页面是在默认浏览器环境中创建的。</p> <p>Page/页面表示浏览器中的一个选项卡页面，是一个类，类中包含了方便的方法和事件，可用来与页面交互(例如选择元素、获取元素信息等等)。</p> <h3 id="访问网站"><a href="#访问网站" class="header-anchor">#</a> 访问网站</h3> <p>我们已经创建了一个新页面，现在尝试访问某个网址：</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">const</span> puppeteer <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'puppeteer'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token punctuation">(</span><span class="token keyword">async</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> browser <span class="token operator">=</span> <span class="token keyword">await</span> puppeteer<span class="token punctuation">.</span><span class="token function">launch</span><span class="token punctuation">(</span><span class="token punctuation">{</span> <span class="token literal-property property">headless</span><span class="token operator">:</span> <span class="token boolean">false</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token comment">// 创建空白页(新选项卡)</span>
  <span class="token keyword">const</span> page <span class="token operator">=</span> <span class="token keyword">await</span> browser<span class="token punctuation">.</span><span class="token function">newPage</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token comment">// 空白页访问指定网址</span>
  <span class="token keyword">await</span> page<span class="token punctuation">.</span><span class="token function">goto</span><span class="token punctuation">(</span><span class="token string">'https://pptr.dev'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token comment">// 获取页面的标题</span>
  <span class="token keyword">const</span> title <span class="token operator">=</span> <span class="token keyword">await</span> page<span class="token punctuation">.</span><span class="token function">title</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  console<span class="token punctuation">.</span><span class="token function">info</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">标题是: </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>title<span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token keyword">await</span> browser<span class="token punctuation">.</span><span class="token function">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>如上所示，使用goto方法访问指定网址，然后获取页面标题，并打印。</p> <p>执行脚本，输出：</p> <div class="language- extra-class"><pre class="language-text"><code>&gt;  node app.js

&gt;  标题是: Puppeteer | Puppeteer
</code></pre></div><p>有时会发现，标题意外地丢失了。</p> <p>原因是页面中并没有真正完成title 元素的加载，导致这个问题可能是由于页面加载很慢，或者页面的一部分是延迟加载的，或者页面被立即导航到另一个页面。</p> <h4 id="等待元素渲染"><a href="#等待元素渲染" class="header-anchor">#</a> 等待元素渲染</h4> <p>解决这个问题，需要等待页面中真正完成title 元素的加载，再获取页面标题，可以使用<code>waitForSelector</code>方法:</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">const</span> puppeteer <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'puppeteer'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token punctuation">(</span><span class="token keyword">async</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> browser <span class="token operator">=</span> <span class="token keyword">await</span> puppeteer<span class="token punctuation">.</span><span class="token function">launch</span><span class="token punctuation">(</span><span class="token punctuation">{</span> <span class="token literal-property property">headless</span><span class="token operator">:</span> <span class="token boolean">false</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">const</span> page <span class="token operator">=</span> <span class="token keyword">await</span> browser<span class="token punctuation">.</span><span class="token function">newPage</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token comment">// 创建空白页(新选项卡)</span>
  <span class="token keyword">await</span> page<span class="token punctuation">.</span><span class="token function">goto</span><span class="token punctuation">(</span><span class="token string">'https://pptr.dev'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token comment">// 等待，直到“title”元素呈现</span>
  <span class="token keyword">await</span> page<span class="token punctuation">.</span><span class="token function">waitForSelector</span><span class="token punctuation">(</span><span class="token string">'title'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token comment">// 获取页面的标题</span>
  <span class="token keyword">const</span> title <span class="token operator">=</span> <span class="token keyword">await</span> page<span class="token punctuation">.</span><span class="token function">title</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  console<span class="token punctuation">.</span><span class="token function">info</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">标题是: </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>title<span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token keyword">await</span> browser<span class="token punctuation">.</span><span class="token function">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>使用waitForSelector方法等待选定的元素在页面中呈现，这样就可以轻松地处理异步呈现，确保元素在页面上是可见的。</p> <p>这样就比较完美，谨慎了</p> <h3 id="设备模拟"><a href="#设备模拟" class="header-anchor">#</a> 设备模拟</h3> <p>Puppeteer提供了模拟各种设备的API，例如模拟iphone。</p> <h4 id="模拟设备的用户代理和视口"><a href="#模拟设备的用户代理和视口" class="header-anchor">#</a> 模拟设备的用户代理和视口</h4> <p>模拟设备通常会涉及2个方面：</p> <ul><li>用户代理(user agent)模拟</li> <li>视口(viewport)模拟</li></ul> <p>让我们模拟一个移动设备:</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">const</span> puppeteer <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'puppeteer'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token punctuation">(</span><span class="token keyword">async</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> browser <span class="token operator">=</span> <span class="token keyword">await</span> puppeteer<span class="token punctuation">.</span><span class="token function">launch</span><span class="token punctuation">(</span><span class="token punctuation">{</span> <span class="token literal-property property">headless</span><span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span> <span class="token literal-property property">devtools</span><span class="token operator">:</span> <span class="token boolean">true</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">const</span> page <span class="token operator">=</span> <span class="token keyword">await</span> browser<span class="token punctuation">.</span><span class="token function">newPage</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token comment">// 模拟一个 iPhone X</span>
  <span class="token keyword">await</span> page<span class="token punctuation">.</span><span class="token function">setUserAgent</span><span class="token punctuation">(</span><span class="token string">'Mozilla/5.0 (iPhone; CPU iPhone OS 11_0 like Mac OS X) AppleWebKit/604.1.38 (KHTML, like Gecko) Version/11.0 Mobile/15A372 Safari/604.1'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">await</span> page<span class="token punctuation">.</span><span class="token function">setViewport</span><span class="token punctuation">(</span><span class="token punctuation">{</span> <span class="token literal-property property">width</span><span class="token operator">:</span> <span class="token number">375</span><span class="token punctuation">,</span> <span class="token literal-property property">height</span><span class="token operator">:</span> <span class="token number">812</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token keyword">await</span> page<span class="token punctuation">.</span><span class="token function">goto</span><span class="token punctuation">(</span><span class="token string">'https://www.qikegu.com'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">//   await browser.close();</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>上面的示例模拟iPhone X，访问指定网页。使用setUserAgent方法设置iPhone X的用户代理，使用setViewport设置iPhone X的视口。</p> <p>对于多个页面，每个页面都可以有自己的用户代理和视口定义。</p> <p>上面示例的chrome运行界面, 在控制台输入下面命令</p> <div class="language-js extra-class"><pre class="language-js"><code>navigator<span class="token punctuation">.</span>userAgent

window<span class="token punctuation">.</span>innerWidth

window<span class="token punctuation">.</span>innerHeight
</code></pre></div><p>得到的值，确实是我们设置的值</p> <h4 id="设备描述-devicedescriptors"><a href="#设备描述-devicedescriptors" class="header-anchor">#</a> 设备描述(DeviceDescriptors)</h4> <p>实际上，要模拟iPhone X，不必显式地设置 iPhone X 的用户代理和视口，Puppeteer中定义了一系列的设备描述以及emulate方法，emulate方法根据预定义的设备描述（包含用户代理参数与视口参数），就可以模拟该设备。emulate方法内部调用了setUserAgent和setViewport。</p> <p>使用emulate方法模拟iphone x：</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">const</span> puppeteer <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'puppeteer'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token punctuation">(</span><span class="token keyword">async</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token comment">// 导入设备描述库</span>
  <span class="token keyword">const</span> devices <span class="token operator">=</span> puppeteer<span class="token punctuation">.</span>KnownDevices

  <span class="token keyword">const</span> browser <span class="token operator">=</span> <span class="token keyword">await</span> puppeteer<span class="token punctuation">.</span><span class="token function">launch</span><span class="token punctuation">(</span><span class="token punctuation">{</span> <span class="token literal-property property">headless</span><span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span> <span class="token literal-property property">devtools</span><span class="token operator">:</span> <span class="token boolean">true</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">const</span> page <span class="token operator">=</span> <span class="token keyword">await</span> browser<span class="token punctuation">.</span><span class="token function">newPage</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token comment">// 模拟iPhone X</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>devices<span class="token punctuation">[</span><span class="token string">'iPhone X'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">await</span> page<span class="token punctuation">.</span><span class="token function">emulate</span><span class="token punctuation">(</span>devices<span class="token punctuation">[</span><span class="token string">'iPhone X'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">await</span> page<span class="token punctuation">.</span><span class="token function">goto</span><span class="token punctuation">(</span><span class="token string">'https://www.qikegu.com'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">//   await browser.close();</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>iPhone X 的配置</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token punctuation">{</span>
  <span class="token literal-property property">name</span><span class="token operator">:</span> <span class="token string">'iPhone X'</span><span class="token punctuation">,</span>
  <span class="token literal-property property">userAgent</span><span class="token operator">:</span> <span class="token string">'Mozilla/5.0 (iPhone; CPU iPhone OS 11_0 like Mac OS X) AppleWebKit/604.1.38 (KHTML, like Gecko) Version/11.0 Mobile/15A372 Safari/604.1'</span><span class="token punctuation">,</span>
  <span class="token literal-property property">viewport</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token literal-property property">width</span><span class="token operator">:</span> <span class="token number">375</span><span class="token punctuation">,</span>
    <span class="token literal-property property">height</span><span class="token operator">:</span> <span class="token number">812</span><span class="token punctuation">,</span>
    <span class="token literal-property property">deviceScaleFactor</span><span class="token operator">:</span> <span class="token number">3</span><span class="token punctuation">,</span>
    <span class="token literal-property property">isMobile</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
    <span class="token literal-property property">hasTouch</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
    <span class="token literal-property property">isLandscape</span><span class="token operator">:</span> <span class="token boolean">false</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><h3 id="事件处理"><a href="#事件处理" class="header-anchor">#</a> 事件处理</h3> <p>Page类通过继承Node.js的EventEmitter类发送事件，这表明node.js中侦听事件的方法都能使用，例如on，once， removeListener等等。</p> <p>以下是支持的事件列表:</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">const</span> puppeteer <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'puppeteer'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token punctuation">(</span><span class="token keyword">async</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> browser <span class="token operator">=</span> <span class="token keyword">await</span> puppeteer<span class="token punctuation">.</span><span class="token function">launch</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">const</span> page <span class="token operator">=</span> <span class="token keyword">await</span> browser<span class="token punctuation">.</span><span class="token function">newPage</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token comment">// 在解析DOM并准备就绪时发出(无需等待资源)</span>
  page<span class="token punctuation">.</span><span class="token function">once</span><span class="token punctuation">(</span><span class="token string">'domcontentloaded'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> console<span class="token punctuation">.</span><span class="token function">info</span><span class="token punctuation">(</span><span class="token string">'√ DOM is ready'</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token comment">// 当页面完全加载时发出</span>
  page<span class="token punctuation">.</span><span class="token function">once</span><span class="token punctuation">(</span><span class="token string">'load'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> console<span class="token punctuation">.</span><span class="token function">info</span><span class="token punctuation">(</span><span class="token string">'√ Page is loaded'</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token comment">// 当页面附加一个frame时发出</span>
  page<span class="token punctuation">.</span><span class="token function">on</span><span class="token punctuation">(</span><span class="token string">'frameattached'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> console<span class="token punctuation">.</span><span class="token function">info</span><span class="token punctuation">(</span><span class="token string">'√ Frame is attached'</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token comment">// 当页面内的frame导航到新URL时发出</span>
  page<span class="token punctuation">.</span><span class="token function">on</span><span class="token punctuation">(</span><span class="token string">'framenavigated'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> console<span class="token punctuation">.</span><span class="token function">info</span><span class="token punctuation">(</span><span class="token string">'➞ Frame is navigated'</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token comment">// 当页面中的脚本使用“console.timeStamp”时发出</span>
  page<span class="token punctuation">.</span><span class="token function">on</span><span class="token punctuation">(</span><span class="token string">'metrics'</span><span class="token punctuation">,</span> <span class="token parameter">data</span> <span class="token operator">=&gt;</span> console<span class="token punctuation">.</span><span class="token function">info</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">➞ Timestamp added at </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>data<span class="token punctuation">.</span>metrics<span class="token punctuation">.</span>Timestamp<span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token comment">// 当页面中的脚本使用“console”时发出</span>
  page<span class="token punctuation">.</span><span class="token function">on</span><span class="token punctuation">(</span><span class="token string">'console'</span><span class="token punctuation">,</span> <span class="token parameter">message</span> <span class="token operator">=&gt;</span> console<span class="token punctuation">[</span>message<span class="token punctuation">.</span><span class="token function">type</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">➞ </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>message<span class="token punctuation">.</span><span class="token function">text</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token comment">// 当页面发生错误事件时发出(例如，页面崩溃)</span>
  page<span class="token punctuation">.</span><span class="token function">on</span><span class="token punctuation">(</span><span class="token string">'error'</span><span class="token punctuation">,</span> <span class="token parameter">error</span> <span class="token operator">=&gt;</span> console<span class="token punctuation">.</span><span class="token function">error</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">✖ </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>error<span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token comment">// 当页面中的脚本有未捕获异常时发出</span>
  page<span class="token punctuation">.</span><span class="token function">on</span><span class="token punctuation">(</span><span class="token string">'pageerror'</span><span class="token punctuation">,</span> <span class="token parameter">error</span> <span class="token operator">=&gt;</span> console<span class="token punctuation">.</span><span class="token function">error</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">✖ </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>error<span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token comment">// 当页面中的脚本使用“alert”、“prompt”、“confirm”或“beforeunload”时发出</span>
  page<span class="token punctuation">.</span><span class="token function">on</span><span class="token punctuation">(</span><span class="token string">'dialog'</span><span class="token punctuation">,</span> <span class="token keyword">async</span> <span class="token parameter">dialog</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">info</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">➞ </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>dialog<span class="token punctuation">.</span><span class="token function">message</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">await</span> dialog<span class="token punctuation">.</span><span class="token function">dismiss</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token comment">// 当打开属于浏览器环境/上下文的新页面时发出</span>
  page<span class="token punctuation">.</span><span class="token function">on</span><span class="token punctuation">(</span><span class="token string">'popup'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> console<span class="token punctuation">.</span><span class="token function">info</span><span class="token punctuation">(</span><span class="token string">'➞ New page is opened'</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token comment">// 当页面产生请求时发出</span>
  page<span class="token punctuation">.</span><span class="token function">on</span><span class="token punctuation">(</span><span class="token string">'request'</span><span class="token punctuation">,</span> <span class="token parameter">request</span> <span class="token operator">=&gt;</span> console<span class="token punctuation">.</span><span class="token function">info</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">➞ Request: </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>request<span class="token punctuation">.</span><span class="token function">url</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token comment">// 当页面生成的请求失败时发出</span>
  page<span class="token punctuation">.</span><span class="token function">on</span><span class="token punctuation">(</span><span class="token string">'requestfailed'</span><span class="token punctuation">,</span> <span class="token parameter">request</span> <span class="token operator">=&gt;</span> console<span class="token punctuation">.</span><span class="token function">info</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">✖ Failed request: </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>request<span class="token punctuation">.</span><span class="token function">url</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token comment">// 当页面生成的请求成功完成时发出</span>
  page<span class="token punctuation">.</span><span class="token function">on</span><span class="token punctuation">(</span><span class="token string">'requestfinished'</span><span class="token punctuation">,</span> <span class="token parameter">request</span> <span class="token operator">=&gt;</span> console<span class="token punctuation">.</span><span class="token function">info</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">➞ Finished request: </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>request<span class="token punctuation">.</span><span class="token function">url</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token comment">// 当接收到响应时发出</span>
  page<span class="token punctuation">.</span><span class="token function">on</span><span class="token punctuation">(</span><span class="token string">'response'</span><span class="token punctuation">,</span> <span class="token parameter">response</span> <span class="token operator">=&gt;</span> console<span class="token punctuation">.</span><span class="token function">info</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">➞ Response: </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>response<span class="token punctuation">.</span><span class="token function">url</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token comment">// 当页面创建专用的网络工作者时发出</span>
  page<span class="token punctuation">.</span><span class="token function">on</span><span class="token punctuation">(</span><span class="token string">'workercreated'</span><span class="token punctuation">,</span> <span class="token parameter">worker</span> <span class="token operator">=&gt;</span> console<span class="token punctuation">.</span><span class="token function">info</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">➞ Worker: </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>worker<span class="token punctuation">.</span><span class="token function">url</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token comment">// 当页面销毁专用的网络工作者时发出</span>
  page<span class="token punctuation">.</span><span class="token function">on</span><span class="token punctuation">(</span><span class="token string">'workerdestroyed'</span><span class="token punctuation">,</span> <span class="token parameter">worker</span> <span class="token operator">=&gt;</span> console<span class="token punctuation">.</span><span class="token function">info</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">➞ Destroyed worker: </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>worker<span class="token punctuation">.</span><span class="token function">url</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token comment">// 当页面分离frame时发出</span>
  page<span class="token punctuation">.</span><span class="token function">on</span><span class="token punctuation">(</span><span class="token string">'framedetached'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> console<span class="token punctuation">.</span><span class="token function">info</span><span class="token punctuation">(</span><span class="token string">'√ Frame is detached'</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token comment">// 关闭页面后发出</span>
  page<span class="token punctuation">.</span><span class="token function">once</span><span class="token punctuation">(</span><span class="token string">'close'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> console<span class="token punctuation">.</span><span class="token function">info</span><span class="token punctuation">(</span><span class="token string">'√ Page is closed'</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token keyword">await</span> page<span class="token punctuation">.</span><span class="token function">goto</span><span class="token punctuation">(</span><span class="token string">'https://www.qikegu.com'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token keyword">await</span> browser<span class="token punctuation">.</span><span class="token function">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>下面的脚本模拟触发部分事件:</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">const</span> puppeteer <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'puppeteer'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token punctuation">(</span><span class="token keyword">async</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> browser <span class="token operator">=</span> <span class="token keyword">await</span> puppeteer<span class="token punctuation">.</span><span class="token function">launch</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">const</span> page <span class="token operator">=</span> <span class="token keyword">await</span> browser<span class="token punctuation">.</span><span class="token function">newPage</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment">// 当页面中的脚本使用“console.timeStamp”时发出</span>
    page<span class="token punctuation">.</span><span class="token function">on</span><span class="token punctuation">(</span><span class="token string">'metrics'</span><span class="token punctuation">,</span> <span class="token parameter">data</span> <span class="token operator">=&gt;</span> console<span class="token punctuation">.</span><span class="token function">info</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">➞ Timestamp added at </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>data<span class="token punctuation">.</span>metrics<span class="token punctuation">.</span>Timestamp<span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">// 当页面中的脚本使用“console”时发出</span>
    page<span class="token punctuation">.</span><span class="token function">on</span><span class="token punctuation">(</span><span class="token string">'console'</span><span class="token punctuation">,</span> <span class="token parameter">message</span> <span class="token operator">=&gt;</span> console<span class="token punctuation">[</span>message<span class="token punctuation">.</span><span class="token function">type</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">➞ </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>message<span class="token punctuation">.</span><span class="token function">text</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">// 当页面中的脚本使用“alert”、“prompt”、“confirm”或“beforeunload”时发出</span>
    page<span class="token punctuation">.</span><span class="token function">on</span><span class="token punctuation">(</span><span class="token string">'dialog'</span><span class="token punctuation">,</span> <span class="token keyword">async</span> <span class="token parameter">dialog</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
        console<span class="token punctuation">.</span><span class="token function">info</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">➞ </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>dialog<span class="token punctuation">.</span><span class="token function">message</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">await</span> dialog<span class="token punctuation">.</span><span class="token function">dismiss</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">// 当页面发生错误事件时发出(例如，页面崩溃)</span>
    page<span class="token punctuation">.</span><span class="token function">on</span><span class="token punctuation">(</span><span class="token string">'error'</span><span class="token punctuation">,</span> <span class="token parameter">error</span> <span class="token operator">=&gt;</span> console<span class="token punctuation">.</span><span class="token function">error</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">✖ </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>error<span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment">// 触发 `metrics` 事件</span>
    <span class="token keyword">await</span> page<span class="token punctuation">.</span><span class="token function">evaluate</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> console<span class="token punctuation">.</span><span class="token function">timeStamp</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment">// 触发 `console` 事件</span>
    <span class="token keyword">await</span> page<span class="token punctuation">.</span><span class="token function">evaluate</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> console<span class="token punctuation">.</span><span class="token function">info</span><span class="token punctuation">(</span><span class="token string">'A console message within the page'</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment">// 触发 `dialog` 事件</span>
    <span class="token keyword">await</span> page<span class="token punctuation">.</span><span class="token function">evaluate</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token function">alert</span><span class="token punctuation">(</span><span class="token string">'An alert within the page'</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment">// 触发 `error` 事件</span>
    <span class="token keyword">await</span> page<span class="token punctuation">.</span><span class="token function">emit</span><span class="token punctuation">(</span><span class="token string">'error'</span><span class="token punctuation">,</span> <span class="token keyword">new</span> <span class="token class-name">Error</span><span class="token punctuation">(</span><span class="token string">'An error within the page'</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment">// 触发 `close` 事件</span>
    <span class="token keyword">await</span> page<span class="token punctuation">.</span><span class="token function">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token keyword">await</span> browser<span class="token punctuation">.</span><span class="token function">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h3 id="鼠标模拟"><a href="#鼠标模拟" class="header-anchor">#</a> 鼠标模拟</h3> <p>Pupeteer中可以模拟鼠标操作，表示鼠标的对象是mouse对象。每个页面含有一个mouse对象，使用mouse类可以模拟鼠标移动、点击等操作。</p> <h4 id="鼠标移动"><a href="#鼠标移动" class="header-anchor">#</a> 鼠标移动</h4> <p>要模拟鼠标移动，可以使用mouse.move方法：</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">const</span> puppeteer <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'puppeteer'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token punctuation">(</span><span class="token keyword">async</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> browser <span class="token operator">=</span> <span class="token keyword">await</span> puppeteer<span class="token punctuation">.</span><span class="token function">launch</span><span class="token punctuation">(</span><span class="token punctuation">{</span> <span class="token literal-property property">headless</span><span class="token operator">:</span> <span class="token boolean">false</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">const</span> page <span class="token operator">=</span> <span class="token keyword">await</span> browser<span class="token punctuation">.</span><span class="token function">newPage</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token keyword">await</span> page<span class="token punctuation">.</span><span class="token function">setViewport</span><span class="token punctuation">(</span><span class="token punctuation">{</span> <span class="token literal-property property">width</span><span class="token operator">:</span> <span class="token number">1920</span><span class="token punctuation">,</span> <span class="token literal-property property">height</span><span class="token operator">:</span> <span class="token number">1080</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">await</span> page<span class="token punctuation">.</span><span class="token function">goto</span><span class="token punctuation">(</span><span class="token string">'https://www.qikegu.com'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token comment">// 等待&quot;后端开发&quot;这部分内容呈现</span>
  <span class="token keyword">await</span> page<span class="token punctuation">.</span><span class="token function">waitForSelector</span><span class="token punctuation">(</span><span class="token string">'a[href=&quot;#pos-java-backend&quot;]'</span><span class="token punctuation">,</span><span class="token punctuation">{</span><span class="token literal-property property">timeout</span><span class="token operator">:</span> <span class="token number">10000</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token keyword">const</span> el <span class="token operator">=</span> <span class="token keyword">await</span> page<span class="token punctuation">.</span><span class="token function">$</span><span class="token punctuation">(</span><span class="token string">'a[href=&quot;#pos-java-backend&quot;'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token comment">// 获取元素的位置</span>
  <span class="token keyword">const</span> sliderRect <span class="token operator">=</span> <span class="token keyword">await</span> page<span class="token punctuation">.</span><span class="token function">evaluate</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">el</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> <span class="token punctuation">{</span>top<span class="token punctuation">,</span> left<span class="token punctuation">,</span> bottom<span class="token punctuation">,</span> right<span class="token punctuation">}</span> <span class="token operator">=</span> el<span class="token punctuation">.</span><span class="token function">getBoundingClientRect</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token keyword">return</span> <span class="token punctuation">{</span>top<span class="token punctuation">,</span> left<span class="token punctuation">,</span> bottom<span class="token punctuation">,</span> right<span class="token punctuation">}</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span> el<span class="token punctuation">)</span>
  
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>sliderRect<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token comment">// 移动鼠标到起点</span>
  <span class="token keyword">await</span> page<span class="token punctuation">.</span>mouse<span class="token punctuation">.</span><span class="token function">move</span><span class="token punctuation">(</span>sliderRect<span class="token punctuation">.</span>left <span class="token operator">+</span> <span class="token number">30</span><span class="token punctuation">,</span> sliderRect<span class="token punctuation">.</span>top <span class="token operator">+</span> <span class="token number">5</span><span class="token punctuation">)</span>

  <span class="token comment">// await browser.close();</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h4 id="鼠标点击"><a href="#鼠标点击" class="header-anchor">#</a> 鼠标点击</h4> <p>要模拟鼠标点击，可以使用mouse.click方法：</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">const</span> puppeteer <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'puppeteer'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token punctuation">(</span><span class="token keyword">async</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> browser <span class="token operator">=</span> <span class="token keyword">await</span> puppeteer<span class="token punctuation">.</span><span class="token function">launch</span><span class="token punctuation">(</span><span class="token punctuation">{</span> <span class="token literal-property property">headless</span><span class="token operator">:</span> <span class="token boolean">false</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">const</span> page <span class="token operator">=</span> <span class="token keyword">await</span> browser<span class="token punctuation">.</span><span class="token function">newPage</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token keyword">await</span> page<span class="token punctuation">.</span><span class="token function">setViewport</span><span class="token punctuation">(</span><span class="token punctuation">{</span> <span class="token literal-property property">width</span><span class="token operator">:</span> <span class="token number">1920</span><span class="token punctuation">,</span> <span class="token literal-property property">height</span><span class="token operator">:</span> <span class="token number">1080</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">await</span> page<span class="token punctuation">.</span><span class="token function">goto</span><span class="token punctuation">(</span><span class="token string">'https://www.qikegu.com'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token comment">// 等待&quot;后端开发&quot;这部分内容呈现</span>
  <span class="token keyword">await</span> page<span class="token punctuation">.</span><span class="token function">waitForSelector</span><span class="token punctuation">(</span><span class="token string">'a[href=&quot;#pos-java-backend&quot;]'</span><span class="token punctuation">,</span><span class="token punctuation">{</span><span class="token literal-property property">timeout</span><span class="token operator">:</span> <span class="token number">10000</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token keyword">const</span> el <span class="token operator">=</span> <span class="token keyword">await</span> page<span class="token punctuation">.</span><span class="token function">$</span><span class="token punctuation">(</span><span class="token string">'a[href=&quot;#pos-java-backend&quot;'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token comment">// 获取元素的位置</span>
  <span class="token keyword">const</span> elRect <span class="token operator">=</span> <span class="token keyword">await</span> page<span class="token punctuation">.</span><span class="token function">evaluate</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">el</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> <span class="token punctuation">{</span>top<span class="token punctuation">,</span> left<span class="token punctuation">,</span> bottom<span class="token punctuation">,</span> right<span class="token punctuation">}</span> <span class="token operator">=</span> el<span class="token punctuation">.</span><span class="token function">getBoundingClientRect</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token keyword">return</span> <span class="token punctuation">{</span>top<span class="token punctuation">,</span> left<span class="token punctuation">,</span> bottom<span class="token punctuation">,</span> right<span class="token punctuation">}</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span> el<span class="token punctuation">)</span>
  
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>elRect<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token comment">// // 移动鼠标到起点</span>
  <span class="token comment">// await page.mouse.move(elRect.left + 30, elRect.top + 5)</span>
  <span class="token comment">// // 按下鼠标</span>
  <span class="token comment">// await page.mouse.down()</span>
  <span class="token comment">// await page.mouse.up()</span>

  <span class="token comment">// 点击，等效上面三句</span>
  <span class="token keyword">await</span> page<span class="token punctuation">.</span>mouse<span class="token punctuation">.</span><span class="token function">click</span><span class="token punctuation">(</span>elRect<span class="token punctuation">.</span>left <span class="token operator">+</span> <span class="token number">30</span><span class="token punctuation">,</span> elRect<span class="token punctuation">.</span>top <span class="token operator">+</span> <span class="token number">5</span><span class="token punctuation">)</span>

  <span class="token comment">// await browser.close();</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>click会依次触发<code>mousemove</code>、<code>mousedown</code>和<code>mouseup</code>事件，click方法中还可以控制鼠标按钮(左、中、右)和点击次数，详情可参考官方API文档。</p> <h4 id="鼠标拖放"><a href="#鼠标拖放" class="header-anchor">#</a> 鼠标拖放</h4> <p>结合使用<code>move</code>，<code>down</code>，<code>up</code>可以模拟鼠标拖放操作。</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">const</span> puppeteer <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'puppeteer'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token punctuation">(</span><span class="token keyword">async</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> browser <span class="token operator">=</span> <span class="token keyword">await</span> puppeteer<span class="token punctuation">.</span><span class="token function">launch</span><span class="token punctuation">(</span><span class="token punctuation">{</span> <span class="token literal-property property">headless</span><span class="token operator">:</span> <span class="token boolean">false</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">const</span> page <span class="token operator">=</span> <span class="token keyword">await</span> browser<span class="token punctuation">.</span><span class="token function">newPage</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token keyword">await</span> page<span class="token punctuation">.</span><span class="token function">setViewport</span><span class="token punctuation">(</span><span class="token punctuation">{</span> <span class="token literal-property property">width</span><span class="token operator">:</span> <span class="token number">1920</span><span class="token punctuation">,</span> <span class="token literal-property property">height</span><span class="token operator">:</span> <span class="token number">1080</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">await</span> page<span class="token punctuation">.</span><span class="token function">goto</span><span class="token punctuation">(</span><span class="token string">'https://www.qikegu.com'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token comment">// 将鼠标从一个点上拖动</span>
  <span class="token keyword">await</span> page<span class="token punctuation">.</span>mouse<span class="token punctuation">.</span><span class="token function">move</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">await</span> page<span class="token punctuation">.</span>mouse<span class="token punctuation">.</span><span class="token function">down</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token comment">// 将鼠标放到另一个点</span>
  <span class="token keyword">await</span> page<span class="token punctuation">.</span>mouse<span class="token punctuation">.</span><span class="token function">move</span><span class="token punctuation">(</span><span class="token number">1000</span><span class="token punctuation">,</span> <span class="token number">1000</span><span class="token punctuation">,</span> <span class="token punctuation">{</span><span class="token literal-property property">steps</span><span class="token operator">:</span> <span class="token number">200</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">await</span> page<span class="token punctuation">.</span>mouse<span class="token punctuation">.</span><span class="token function">up</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token comment">// await browser.close();</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h3 id="键盘模拟"><a href="#键盘模拟" class="header-anchor">#</a> 键盘模拟</h3> <p>键盘是与页面交互的另一种方式，主要用于输入。与鼠标类似，Puppeteer通过一个名为keyboard的类表示键盘，每个页面实例都包含这样一个键盘实例。</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">const</span> puppeteer <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'puppeteer'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token punctuation">(</span><span class="token keyword">async</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> browser <span class="token operator">=</span> <span class="token keyword">await</span> puppeteer<span class="token punctuation">.</span><span class="token function">launch</span><span class="token punctuation">(</span><span class="token punctuation">{</span> <span class="token literal-property property">headless</span><span class="token operator">:</span> <span class="token boolean">false</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">const</span> page <span class="token operator">=</span> <span class="token keyword">await</span> browser<span class="token punctuation">.</span><span class="token function">newPage</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token keyword">await</span> page<span class="token punctuation">.</span><span class="token function">setViewport</span><span class="token punctuation">(</span><span class="token punctuation">{</span> <span class="token literal-property property">width</span><span class="token operator">:</span> <span class="token number">1920</span><span class="token punctuation">,</span> <span class="token literal-property property">height</span><span class="token operator">:</span> <span class="token number">1080</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">await</span> page<span class="token punctuation">.</span><span class="token function">goto</span><span class="token punctuation">(</span><span class="token string">'https://www.qikegu.com'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token comment">// 等待工具栏呈现</span>
  <span class="token keyword">await</span> page<span class="token punctuation">.</span><span class="token function">waitForSelector</span><span class="token punctuation">(</span><span class="token string">'form.search-form'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token comment">// 焦点设置到搜索输入</span>
  <span class="token keyword">await</span> page<span class="token punctuation">.</span><span class="token function">focus</span><span class="token punctuation">(</span><span class="token string">'form.search-form [type=&quot;search&quot;]'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token comment">// 将文本键入焦点元素</span>
  <span class="token keyword">await</span> page<span class="token punctuation">.</span>keyboard<span class="token punctuation">.</span><span class="token function">type</span><span class="token punctuation">(</span><span class="token string">'puppeteer'</span><span class="token punctuation">,</span> <span class="token punctuation">{</span> <span class="token literal-property property">delay</span><span class="token operator">:</span> <span class="token number">1000</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token comment">// 回车</span>
  <span class="token keyword">await</span> page<span class="token punctuation">.</span>keyboard<span class="token punctuation">.</span><span class="token function">press</span><span class="token punctuation">(</span><span class="token string">'Enter'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">//   await browser.close();</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h3 id="截屏"><a href="#截屏" class="header-anchor">#</a> 截屏</h3> <p>Puppeteer中截屏是一个非常简单的任务，可使用<a href="https://puppeteer.bootcss.com/api#pagescreenshotoptions" target="_blank" rel="noopener noreferrer">page.screenshot<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>方法。</p> <h4 id="截屏整个页面"><a href="#截屏整个页面" class="header-anchor">#</a> 截屏整个页面</h4> <p><code>page.screenshot</code>方法默认截屏整个页面：</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">const</span> puppeteer <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'puppeteer'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token punctuation">(</span><span class="token keyword">async</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> browser <span class="token operator">=</span> <span class="token keyword">await</span> puppeteer<span class="token punctuation">.</span><span class="token function">launch</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">const</span> page <span class="token operator">=</span> <span class="token keyword">await</span> browser<span class="token punctuation">.</span><span class="token function">newPage</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token keyword">await</span> page<span class="token punctuation">.</span><span class="token function">setViewport</span><span class="token punctuation">(</span><span class="token punctuation">{</span> <span class="token literal-property property">width</span><span class="token operator">:</span> <span class="token number">1920</span><span class="token punctuation">,</span> <span class="token literal-property property">height</span><span class="token operator">:</span> <span class="token number">1080</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">await</span> page<span class="token punctuation">.</span><span class="token function">goto</span><span class="token punctuation">(</span><span class="token string">'https://www.qikegu.com'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">await</span> page<span class="token punctuation">.</span><span class="token function">waitForSelector</span><span class="token punctuation">(</span><span class="token string">'title'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token comment">// 截屏整个视图</span>
  <span class="token keyword">await</span> page<span class="token punctuation">.</span><span class="token function">screenshot</span><span class="token punctuation">(</span><span class="token punctuation">{</span> <span class="token literal-property property">path</span><span class="token operator">:</span> <span class="token string">'screenshot.png'</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token keyword">await</span> browser<span class="token punctuation">.</span><span class="token function">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>运行代码之后，就发现项目根目录，有一张 <code>screenshot.png</code> 图片了</p> <p><code>page.screenshot</code>方法还有很多参数，如保存的图片类型、图片质量等等。</p> <p>下面的例子，截屏页面中的一个指定区域：</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">const</span> puppeteer <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'puppeteer'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token punctuation">(</span><span class="token keyword">async</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> browser <span class="token operator">=</span> <span class="token keyword">await</span> puppeteer<span class="token punctuation">.</span><span class="token function">launch</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">const</span> page <span class="token operator">=</span> <span class="token keyword">await</span> browser<span class="token punctuation">.</span><span class="token function">newPage</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token keyword">await</span> page<span class="token punctuation">.</span><span class="token function">setViewport</span><span class="token punctuation">(</span><span class="token punctuation">{</span> <span class="token literal-property property">width</span><span class="token operator">:</span> <span class="token number">1920</span><span class="token punctuation">,</span> <span class="token literal-property property">height</span><span class="token operator">:</span> <span class="token number">1080</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">await</span> page<span class="token punctuation">.</span><span class="token function">goto</span><span class="token punctuation">(</span><span class="token string">'https://www.qikegu.com'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">await</span> page<span class="token punctuation">.</span><span class="token function">waitForSelector</span><span class="token punctuation">(</span><span class="token string">'title'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token comment">// 截屏页面中的一个区域</span>
  <span class="token keyword">await</span> page<span class="token punctuation">.</span><span class="token function">screenshot</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
    <span class="token literal-property property">path</span><span class="token operator">:</span> <span class="token string">'screenshot.jpg'</span><span class="token punctuation">,</span>
    <span class="token literal-property property">type</span><span class="token operator">:</span> <span class="token string">'jpeg'</span><span class="token punctuation">,</span>
    <span class="token literal-property property">quality</span><span class="token operator">:</span> <span class="token number">80</span><span class="token punctuation">,</span>
    <span class="token literal-property property">clip</span><span class="token operator">:</span> <span class="token punctuation">{</span> <span class="token literal-property property">x</span><span class="token operator">:</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token literal-property property">y</span><span class="token operator">:</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token literal-property property">width</span><span class="token operator">:</span> <span class="token number">300</span><span class="token punctuation">,</span> <span class="token literal-property property">height</span><span class="token operator">:</span> <span class="token number">300</span> <span class="token punctuation">}</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token keyword">await</span> browser<span class="token punctuation">.</span><span class="token function">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h3 id="生成pdf"><a href="#生成pdf" class="header-anchor">#</a> 生成PDF</h3> <p>Puppeteer可以根据网页内容生成pdf文件。要生成pdf文件，可使用<code>page.pdf</code>方法。</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">const</span> puppeteer <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'puppeteer'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token punctuation">(</span><span class="token keyword">async</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> browser <span class="token operator">=</span> <span class="token keyword">await</span> puppeteer<span class="token punctuation">.</span><span class="token function">launch</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">const</span> page <span class="token operator">=</span> <span class="token keyword">await</span> browser<span class="token punctuation">.</span><span class="token function">newPage</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token comment">// 导航到项目自述文件</span>
  <span class="token keyword">await</span> page<span class="token punctuation">.</span><span class="token function">goto</span><span class="token punctuation">(</span><span class="token string">'https://www.baidu.com'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token comment">// 从页面内容生成PDF</span>
  <span class="token keyword">await</span> page<span class="token punctuation">.</span><span class="token function">pdf</span><span class="token punctuation">(</span><span class="token punctuation">{</span> <span class="token literal-property property">path</span><span class="token operator">:</span> <span class="token string">'out.pdf'</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token keyword">await</span> browser<span class="token punctuation">.</span><span class="token function">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

</code></pre></div><h3 id="地理位置模拟"><a href="#地理位置模拟" class="header-anchor">#</a> 地理位置模拟</h3> <p>许多网站根据用户的地理位置定制内容。要修改用户的地理位置，可以使用<code>page.setGeolocation</code>方法。</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">const</span> puppeteer <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'puppeteer'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token punctuation">(</span><span class="token keyword">async</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> browser <span class="token operator">=</span> <span class="token keyword">await</span> puppeteer<span class="token punctuation">.</span><span class="token function">launch</span><span class="token punctuation">(</span><span class="token punctuation">{</span> <span class="token literal-property property">devtools</span><span class="token operator">:</span> <span class="token boolean">true</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">const</span> page <span class="token operator">=</span> <span class="token keyword">await</span> browser<span class="token punctuation">.</span><span class="token function">newPage</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token comment">// 授予更改地理位置的权限</span>
  <span class="token keyword">const</span> context <span class="token operator">=</span> browser<span class="token punctuation">.</span><span class="token function">defaultBrowserContext</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">await</span> context<span class="token punctuation">.</span><span class="token function">overridePermissions</span><span class="token punctuation">(</span><span class="token string">'https://www.qikegu.com'</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token string">'geolocation'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token keyword">await</span> page<span class="token punctuation">.</span><span class="token function">goto</span><span class="token punctuation">(</span><span class="token string">'https://www.qikegu.com'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">await</span> page<span class="token punctuation">.</span><span class="token function">waitForSelector</span><span class="token punctuation">(</span><span class="token string">'title'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token comment">// 设置为北极位置</span>
  <span class="token keyword">await</span> page<span class="token punctuation">.</span><span class="token function">setGeolocation</span><span class="token punctuation">(</span><span class="token punctuation">{</span> <span class="token literal-property property">latitude</span><span class="token operator">:</span> <span class="token number">90</span><span class="token punctuation">,</span> <span class="token literal-property property">longitude</span><span class="token operator">:</span> <span class="token number">0</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token comment">// await browser.close();</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>上面示例中，先授予浏览器环境适当的权限，然后使用setGeolocation用北极坐标覆盖当前的地理位置。</p> <p>运行脚本后，在打开的浏览器的console中，可以打印出用户经纬度：</p> <div class="language-js extra-class"><pre class="language-js"><code>navigator<span class="token punctuation">.</span>geolocation<span class="token punctuation">.</span><span class="token function">getCurrentPosition</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">pos</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> console<span class="token punctuation">.</span><span class="token function">info</span><span class="token punctuation">(</span><span class="token string">'Latitude:'</span><span class="token punctuation">,</span> pos<span class="token punctuation">.</span>coords<span class="token punctuation">.</span>latitude<span class="token punctuation">,</span><span class="token string">', Longitude:'</span><span class="token punctuation">,</span> pos<span class="token punctuation">.</span>coords<span class="token punctuation">.</span>longitude<span class="token punctuation">)</span><span class="token punctuation">)</span>
</code></pre></div><h3 id="阻止javascript"><a href="#阻止javascript" class="header-anchor">#</a> 阻止Javascript</h3> <p>有时需要禁止Javascript，可以通过拦截请求，判断类型是“script”，阻止加载。</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">const</span> puppeteer <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'puppeteer'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token punctuation">(</span><span class="token keyword">async</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> browser <span class="token operator">=</span> <span class="token keyword">await</span> puppeteer<span class="token punctuation">.</span><span class="token function">launch</span><span class="token punctuation">(</span><span class="token punctuation">{</span> 
    <span class="token literal-property property">headless</span><span class="token operator">:</span> <span class="token boolean">false</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">const</span> page <span class="token operator">=</span> <span class="token keyword">await</span> browser<span class="token punctuation">.</span><span class="token function">newPage</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token keyword">await</span> page<span class="token punctuation">.</span><span class="token function">setRequestInterception</span><span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token comment">// 监听拦截请求事件</span>
  page<span class="token punctuation">.</span><span class="token function">on</span><span class="token punctuation">(</span><span class="token string">'request'</span><span class="token punctuation">,</span> <span class="token parameter">request</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>

    <span class="token keyword">if</span> <span class="token punctuation">(</span>request<span class="token punctuation">.</span><span class="token function">resourceType</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">===</span> <span class="token string">'script'</span><span class="token punctuation">)</span>
      request<span class="token punctuation">.</span><span class="token function">abort</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">else</span>
      request<span class="token punctuation">.</span><span class="token function">continue</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token keyword">await</span> page<span class="token punctuation">.</span><span class="token function">goto</span><span class="token punctuation">(</span><span class="token string">'https://www.baidu.com'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token comment">// await browser.close();</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

</code></pre></div><p>百度太厉害了，禁止了他的js, 照样可以搜索，大家可以自己去调试看看</p> <h3 id="获取页面源代码"><a href="#获取页面源代码" class="header-anchor">#</a> 获取页面源代码</h3> <p>要获取页面的HTML源代码，可以使用<code>page.content()</code>方法。</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">const</span> puppeteer <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'puppeteer'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> fs <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'fs'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token punctuation">(</span><span class="token keyword">async</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> browser <span class="token operator">=</span> <span class="token keyword">await</span> puppeteer<span class="token punctuation">.</span><span class="token function">launch</span><span class="token punctuation">(</span><span class="token punctuation">{</span> 
    <span class="token literal-property property">headless</span><span class="token operator">:</span> <span class="token boolean">false</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">const</span> page <span class="token operator">=</span> <span class="token keyword">await</span> browser<span class="token punctuation">.</span><span class="token function">newPage</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">await</span> page<span class="token punctuation">.</span><span class="token function">goto</span><span class="token punctuation">(</span><span class="token string">'https://www.baidu.com'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token comment">// 等待，直到“title”元素呈现</span>
  <span class="token keyword">await</span> page<span class="token punctuation">.</span><span class="token function">waitForSelector</span><span class="token punctuation">(</span><span class="token string">'title'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token keyword">const</span> html <span class="token operator">=</span> <span class="token keyword">await</span> page<span class="token punctuation">.</span><span class="token function">content</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token comment">// 将html保存到一个文件中</span>
  fs<span class="token punctuation">.</span><span class="token function">writeFile</span><span class="token punctuation">(</span><span class="token string">'page.html'</span><span class="token punctuation">,</span> html<span class="token punctuation">,</span> <span class="token parameter">_</span> <span class="token operator">=&gt;</span> console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'HTML saved'</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token comment">//... 做一些事</span>
  <span class="token keyword">await</span> browser<span class="token punctuation">.</span><span class="token function">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h3 id="可访问性-accessibility"><a href="#可访问性-accessibility" class="header-anchor">#</a> 可访问性(Accessibility)</h3> <p>可访问性是一个web标准，是指Web内容对于残障用户的可阅读和可理解性。例如对于盲人，支持文字语音就是提高可访问性的一个具体功能。提高可访问性也能让普通用户更容易理解Web内容。</p> <p>可访问性树是DOM的子集，包含与辅助技术(如屏幕阅读器、语音控制等)信息相关的元素。拥有可访问性树，意味着我们可以分析和测试页面中的可访问性支持。</p> <p>Puppeteer可以通过<code>page.accessibility</code>获取可访问性树的当前状态:</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">const</span> puppeteer <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'puppeteer'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token punctuation">(</span><span class="token keyword">async</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> browser <span class="token operator">=</span> <span class="token keyword">await</span> puppeteer<span class="token punctuation">.</span><span class="token function">launch</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">const</span> page <span class="token operator">=</span> <span class="token keyword">await</span> browser<span class="token punctuation">.</span><span class="token function">newPage</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token keyword">await</span> page<span class="token punctuation">.</span><span class="token function">goto</span><span class="token punctuation">(</span><span class="token string">'https://www.baidu.com'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">await</span> page<span class="token punctuation">.</span><span class="token function">waitForSelector</span><span class="token punctuation">(</span><span class="token string">'title'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token comment">// 获取可访问性树的当前状态</span>
  <span class="token keyword">const</span> snapshot <span class="token operator">=</span> <span class="token keyword">await</span> page<span class="token punctuation">.</span>accessibility<span class="token punctuation">.</span><span class="token function">snapshot</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  console<span class="token punctuation">.</span><span class="token function">info</span><span class="token punctuation">(</span>snapshot<span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token keyword">await</span> browser<span class="token punctuation">.</span><span class="token function">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h3 id="代码覆盖率"><a href="#代码覆盖率" class="header-anchor">#</a> 代码覆盖率</h3> <p>代码覆盖率（Code Coverage）用于衡量一个源文件里有多少代码是被用到的。例如，某个网页引用了一个css文件，通常该网页只会使用css文件中的一部分代码，这样就可以计算用到的代码量与文件中全部代码量的比率。</p> <p>代码覆盖率统计功能是作为Chrome v59的一部分正式引入的，通过统计代码覆盖率，可以减少无用代码，加快页面加载速度。</p> <p>Puppeteer中，可用通过<code>page.coverage</code>使用代码覆盖率统计功能。</p> <p>计算百度首页内，javascript文件与css文件的有效代码量。</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">const</span> puppeteer <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'puppeteer'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token punctuation">(</span><span class="token keyword">async</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> browser <span class="token operator">=</span> <span class="token keyword">await</span> puppeteer<span class="token punctuation">.</span><span class="token function">launch</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">const</span> page <span class="token operator">=</span> <span class="token keyword">await</span> browser<span class="token punctuation">.</span><span class="token function">newPage</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token comment">// 开始收集JS和CSS文件的覆盖率信息</span>
  <span class="token keyword">await</span> Promise<span class="token punctuation">.</span><span class="token function">all</span><span class="token punctuation">(</span><span class="token punctuation">[</span>page<span class="token punctuation">.</span>coverage<span class="token punctuation">.</span><span class="token function">startJSCoverage</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> page<span class="token punctuation">.</span>coverage<span class="token punctuation">.</span><span class="token function">startCSSCoverage</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token keyword">await</span> page<span class="token punctuation">.</span><span class="token function">goto</span><span class="token punctuation">(</span><span class="token string">'https://www.baidu.com'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">await</span> page<span class="token punctuation">.</span><span class="token function">waitForSelector</span><span class="token punctuation">(</span><span class="token string">'title'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token comment">// 停止收集覆盖率信息</span>
  <span class="token keyword">const</span> <span class="token punctuation">[</span>jsCoverage<span class="token punctuation">,</span> cssCoverage<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token keyword">await</span> Promise<span class="token punctuation">.</span><span class="token function">all</span><span class="token punctuation">(</span><span class="token punctuation">[</span>
    page<span class="token punctuation">.</span>coverage<span class="token punctuation">.</span><span class="token function">stopJSCoverage</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    page<span class="token punctuation">.</span>coverage<span class="token punctuation">.</span><span class="token function">stopCSSCoverage</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  <span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token comment">// 根据覆盖率计算使用了多少字节</span>
  <span class="token keyword">const</span> <span class="token function-variable function">calculateUsedBytes</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">type<span class="token punctuation">,</span> coverage</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span>
    coverage<span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter"><span class="token punctuation">{</span> url<span class="token punctuation">,</span> ranges<span class="token punctuation">,</span> text <span class="token punctuation">}</span></span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
      <span class="token keyword">let</span> usedBytes <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>

      ranges<span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span><span class="token parameter">range</span> <span class="token operator">=&gt;</span> <span class="token punctuation">(</span>usedBytes <span class="token operator">+=</span> range<span class="token punctuation">.</span>end <span class="token operator">-</span> range<span class="token punctuation">.</span>start <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

      <span class="token keyword">return</span> <span class="token punctuation">{</span>
        url<span class="token punctuation">,</span>
        type<span class="token punctuation">,</span>
        usedBytes<span class="token punctuation">,</span>
        <span class="token literal-property property">totalBytes</span><span class="token operator">:</span> text<span class="token punctuation">.</span>length
      <span class="token punctuation">}</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  console<span class="token punctuation">.</span><span class="token function">info</span><span class="token punctuation">(</span><span class="token punctuation">[</span>
    <span class="token operator">...</span><span class="token function">calculateUsedBytes</span><span class="token punctuation">(</span><span class="token string">'js'</span><span class="token punctuation">,</span> jsCoverage<span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token operator">...</span><span class="token function">calculateUsedBytes</span><span class="token punctuation">(</span><span class="token string">'css'</span><span class="token punctuation">,</span> cssCoverage<span class="token punctuation">)</span>
  <span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token keyword">await</span> browser<span class="token punctuation">.</span><span class="token function">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>上面示例中，</p> <p>首先为JavaScript和CSS文件收集覆盖率信息，直到页面加载完成。</p> <p>然后，定义<code>calculateUsedBytes</code>函数，它将遍历收集的覆盖率数据，计算使用了多少字节(基于覆盖率)。</p> <p>最后，对收集到覆盖率信息：<code>jsCoverage</code>与<code>cssCoverage</code>，调用<code>calculateUsedBytes</code>函数，计算使用到的字节数。</p> <p>运行脚本的输出:</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token punctuation">[</span>
  <span class="token punctuation">{</span>
    <span class="token literal-property property">url</span><span class="token operator">:</span> <span class="token string">'https://www.baidu.com/'</span><span class="token punctuation">,</span>
    <span class="token literal-property property">type</span><span class="token operator">:</span> <span class="token string">'js'</span><span class="token punctuation">,</span>
    <span class="token literal-property property">usedBytes</span><span class="token operator">:</span> <span class="token number">137</span><span class="token punctuation">,</span>
    <span class="token literal-property property">totalBytes</span><span class="token operator">:</span> <span class="token number">925</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token punctuation">{</span>
    <span class="token literal-property property">url</span><span class="token operator">:</span> <span class="token string">'https://www.baidu.com/'</span><span class="token punctuation">,</span>
    <span class="token literal-property property">type</span><span class="token operator">:</span> <span class="token string">'js'</span><span class="token punctuation">,</span>
    <span class="token literal-property property">usedBytes</span><span class="token operator">:</span> <span class="token number">12</span><span class="token punctuation">,</span>
    <span class="token literal-property property">totalBytes</span><span class="token operator">:</span> <span class="token number">154</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token punctuation">{</span>
    <span class="token literal-property property">url</span><span class="token operator">:</span> <span class="token string">'https://www.baidu.com/'</span><span class="token punctuation">,</span>
    <span class="token literal-property property">type</span><span class="token operator">:</span> <span class="token string">'js'</span><span class="token punctuation">,</span>
    <span class="token literal-property property">usedBytes</span><span class="token operator">:</span> <span class="token number">336</span><span class="token punctuation">,</span>
    <span class="token literal-property property">totalBytes</span><span class="token operator">:</span> <span class="token number">407</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token punctuation">{</span>
    <span class="token literal-property property">url</span><span class="token operator">:</span> <span class="token string">'https://www.baidu.com/'</span><span class="token punctuation">,</span>
    <span class="token literal-property property">type</span><span class="token operator">:</span> <span class="token string">'js'</span><span class="token punctuation">,</span>
    <span class="token literal-property property">usedBytes</span><span class="token operator">:</span> <span class="token number">1025</span><span class="token punctuation">,</span>
    <span class="token literal-property property">totalBytes</span><span class="token operator">:</span> <span class="token number">5296</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token punctuation">{</span>
    <span class="token literal-property property">url</span><span class="token operator">:</span> <span class="token string">'https://www.baidu.com/'</span><span class="token punctuation">,</span>
    <span class="token literal-property property">type</span><span class="token operator">:</span> <span class="token string">'js'</span><span class="token punctuation">,</span>
    <span class="token literal-property property">usedBytes</span><span class="token operator">:</span> <span class="token number">17</span><span class="token punctuation">,</span>
    <span class="token literal-property property">totalBytes</span><span class="token operator">:</span> <span class="token number">46</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token punctuation">{</span>
    <span class="token literal-property property">url</span><span class="token operator">:</span> <span class="token string">'https://www.baidu.com/'</span><span class="token punctuation">,</span>
    <span class="token literal-property property">type</span><span class="token operator">:</span> <span class="token string">'js'</span><span class="token punctuation">,</span>
    <span class="token literal-property property">usedBytes</span><span class="token operator">:</span> <span class="token number">50</span><span class="token punctuation">,</span>
    <span class="token literal-property property">totalBytes</span><span class="token operator">:</span> <span class="token number">153</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token punctuation">{</span>
    <span class="token literal-property property">url</span><span class="token operator">:</span> <span class="token string">'https://www.baidu.com/'</span><span class="token punctuation">,</span>
    <span class="token literal-property property">type</span><span class="token operator">:</span> <span class="token string">'js'</span><span class="token punctuation">,</span>
    <span class="token literal-property property">usedBytes</span><span class="token operator">:</span> <span class="token number">23</span><span class="token punctuation">,</span>
    <span class="token literal-property property">totalBytes</span><span class="token operator">:</span> <span class="token number">91</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token punctuation">{</span>
    <span class="token literal-property property">url</span><span class="token operator">:</span> <span class="token string">'https://www.baidu.com/'</span><span class="token punctuation">,</span>
    <span class="token literal-property property">type</span><span class="token operator">:</span> <span class="token string">'js'</span><span class="token punctuation">,</span>
    <span class="token literal-property property">usedBytes</span><span class="token operator">:</span> <span class="token number">9475</span><span class="token punctuation">,</span>
    <span class="token literal-property property">totalBytes</span><span class="token operator">:</span> <span class="token number">9548</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token punctuation">{</span>
    <span class="token literal-property property">url</span><span class="token operator">:</span> <span class="token string">'https://dss0.bdstatic.com/5aV1bjqh_Q23odCf/static/superman/js/lib/jquery-1-edb203c114.10.2.js'</span><span class="token punctuation">,</span>
    <span class="token literal-property property">type</span><span class="token operator">:</span> <span class="token string">'js'</span><span class="token punctuation">,</span>
    <span class="token literal-property property">usedBytes</span><span class="token operator">:</span> <span class="token number">65350</span><span class="token punctuation">,</span>
    <span class="token literal-property property">totalBytes</span><span class="token operator">:</span> <span class="token number">143928</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token punctuation">{</span>
    <span class="token literal-property property">url</span><span class="token operator">:</span> <span class="token string">'https://dss0.bdstatic.com/5aV1bjqh_Q23odCf/static/superman/js/lib/esl-d776bfb1aa.js'</span><span class="token punctuation">,</span>
    <span class="token literal-property property">type</span><span class="token operator">:</span> <span class="token string">'js'</span><span class="token punctuation">,</span>
    <span class="token literal-property property">usedBytes</span><span class="token operator">:</span> <span class="token number">10514</span><span class="token punctuation">,</span>
    <span class="token literal-property property">totalBytes</span><span class="token operator">:</span> <span class="token number">16420</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token punctuation">{</span>
    <span class="token literal-property property">url</span><span class="token operator">:</span> <span class="token string">'https://www.baidu.com/'</span><span class="token punctuation">,</span>
    <span class="token literal-property property">type</span><span class="token operator">:</span> <span class="token string">'js'</span><span class="token punctuation">,</span>
    <span class="token literal-property property">usedBytes</span><span class="token operator">:</span> <span class="token number">448</span><span class="token punctuation">,</span>
    <span class="token literal-property property">totalBytes</span><span class="token operator">:</span> <span class="token number">517</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token punctuation">{</span>
    <span class="token literal-property property">url</span><span class="token operator">:</span> <span class="token string">'https://www.baidu.com/'</span><span class="token punctuation">,</span>
    <span class="token literal-property property">type</span><span class="token operator">:</span> <span class="token string">'js'</span><span class="token punctuation">,</span>
    <span class="token literal-property property">usedBytes</span><span class="token operator">:</span> <span class="token number">3586</span><span class="token punctuation">,</span>
    <span class="token literal-property property">totalBytes</span><span class="token operator">:</span> <span class="token number">10290</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token punctuation">{</span>
    <span class="token literal-property property">url</span><span class="token operator">:</span> <span class="token string">'https://pss.bdstatic.com/r/www/cache/static/protocol/https/bundles/es6-polyfill_5645e88.js'</span><span class="token punctuation">,</span>
    <span class="token literal-property property">type</span><span class="token operator">:</span> <span class="token string">'js'</span><span class="token punctuation">,</span>
    <span class="token literal-property property">usedBytes</span><span class="token operator">:</span> <span class="token number">22429</span><span class="token punctuation">,</span>
    <span class="token literal-property property">totalBytes</span><span class="token operator">:</span> <span class="token number">71823</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token punctuation">{</span>
    <span class="token literal-property property">url</span><span class="token operator">:</span> <span class="token string">'https://pss.bdstatic.com/r/www/cache/static/protocol/https/plugins/every_cookie_mac_82990d4.js'</span><span class="token punctuation">,</span>
    <span class="token literal-property property">type</span><span class="token operator">:</span> <span class="token string">'js'</span><span class="token punctuation">,</span>
    <span class="token literal-property property">usedBytes</span><span class="token operator">:</span> <span class="token number">1515</span><span class="token punctuation">,</span>
    <span class="token literal-property property">totalBytes</span><span class="token operator">:</span> <span class="token number">2556</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token punctuation">{</span>
    <span class="token literal-property property">url</span><span class="token operator">:</span> <span class="token string">'https://pss.bdstatic.com/r/www/cache/static/protocol/https/bundles/polyfill_9354efa.js'</span><span class="token punctuation">,</span>
    <span class="token literal-property property">type</span><span class="token operator">:</span> <span class="token string">'js'</span><span class="token punctuation">,</span>
    <span class="token literal-property property">usedBytes</span><span class="token operator">:</span> <span class="token number">13199</span><span class="token punctuation">,</span>
    <span class="token literal-property property">totalBytes</span><span class="token operator">:</span> <span class="token number">41939</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token punctuation">{</span>
    <span class="token literal-property property">url</span><span class="token operator">:</span> <span class="token string">'https://pss.bdstatic.com/r/www/cache/static/protocol/https/global/js/all_async_search_4f981bf.js'</span><span class="token punctuation">,</span>
    <span class="token literal-property property">type</span><span class="token operator">:</span> <span class="token string">'js'</span><span class="token punctuation">,</span>
    <span class="token literal-property property">usedBytes</span><span class="token operator">:</span> <span class="token number">107953</span><span class="token punctuation">,</span>
    <span class="token literal-property property">totalBytes</span><span class="token operator">:</span> <span class="token number">684164</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token punctuation">{</span>
    <span class="token literal-property property">url</span><span class="token operator">:</span> <span class="token string">'https://www.baidu.com/'</span><span class="token punctuation">,</span>
    <span class="token literal-property property">type</span><span class="token operator">:</span> <span class="token string">'js'</span><span class="token punctuation">,</span>
    <span class="token literal-property property">usedBytes</span><span class="token operator">:</span> <span class="token number">467</span><span class="token punctuation">,</span>
    <span class="token literal-property property">totalBytes</span><span class="token operator">:</span> <span class="token number">624</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token punctuation">{</span>
    <span class="token literal-property property">url</span><span class="token operator">:</span> <span class="token string">'https://www.baidu.com/'</span><span class="token punctuation">,</span>
    <span class="token literal-property property">type</span><span class="token operator">:</span> <span class="token string">'js'</span><span class="token punctuation">,</span>
    <span class="token literal-property property">usedBytes</span><span class="token operator">:</span> <span class="token number">495</span><span class="token punctuation">,</span>
    <span class="token literal-property property">totalBytes</span><span class="token operator">:</span> <span class="token number">2141</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token punctuation">{</span>
    <span class="token literal-property property">url</span><span class="token operator">:</span> <span class="token string">'https://www.baidu.com/'</span><span class="token punctuation">,</span>
    <span class="token literal-property property">type</span><span class="token operator">:</span> <span class="token string">'js'</span><span class="token punctuation">,</span>
    <span class="token literal-property property">usedBytes</span><span class="token operator">:</span> <span class="token number">1129</span><span class="token punctuation">,</span>
    <span class="token literal-property property">totalBytes</span><span class="token operator">:</span> <span class="token number">1423</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token punctuation">{</span>
    <span class="token literal-property property">url</span><span class="token operator">:</span> <span class="token string">'https://dss0.bdstatic.com/5aV1bjqh_Q23odCf/static/superman/js/sbase-829e78c5bb.js'</span><span class="token punctuation">,</span>
    <span class="token literal-property property">type</span><span class="token operator">:</span> <span class="token string">'js'</span><span class="token punctuation">,</span>
    <span class="token literal-property property">usedBytes</span><span class="token operator">:</span> <span class="token number">16199</span><span class="token punctuation">,</span>
    <span class="token literal-property property">totalBytes</span><span class="token operator">:</span> <span class="token number">55552</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token punctuation">{</span>
    <span class="token literal-property property">url</span><span class="token operator">:</span> <span class="token string">'https://www.baidu.com/'</span><span class="token punctuation">,</span>
    <span class="token literal-property property">type</span><span class="token operator">:</span> <span class="token string">'js'</span><span class="token punctuation">,</span>
    <span class="token literal-property property">usedBytes</span><span class="token operator">:</span> <span class="token number">8238</span><span class="token punctuation">,</span>
    <span class="token literal-property property">totalBytes</span><span class="token operator">:</span> <span class="token number">8473</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token punctuation">{</span>
    <span class="token literal-property property">url</span><span class="token operator">:</span> <span class="token string">'https://www.baidu.com/'</span><span class="token punctuation">,</span>
    <span class="token literal-property property">type</span><span class="token operator">:</span> <span class="token string">'js'</span><span class="token punctuation">,</span>
    <span class="token literal-property property">usedBytes</span><span class="token operator">:</span> <span class="token number">209</span><span class="token punctuation">,</span>
    <span class="token literal-property property">totalBytes</span><span class="token operator">:</span> <span class="token number">307</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token punctuation">{</span>
    <span class="token literal-property property">url</span><span class="token operator">:</span> <span class="token string">'https://dss0.bdstatic.com/5aV1bjqh_Q23odCf/static/superman/js/s_super_index-3fffae8d60.js'</span><span class="token punctuation">,</span>
    <span class="token literal-property property">type</span><span class="token operator">:</span> <span class="token string">'js'</span><span class="token punctuation">,</span>
    <span class="token literal-property property">usedBytes</span><span class="token operator">:</span> <span class="token number">416</span><span class="token punctuation">,</span>
    <span class="token literal-property property">totalBytes</span><span class="token operator">:</span> <span class="token number">1022</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token punctuation">{</span>
    <span class="token literal-property property">url</span><span class="token operator">:</span> <span class="token string">'https://dss0.bdstatic.com/5aV1bjqh_Q23odCf/static/superman/js/min_super-59ec6c653e.js'</span><span class="token punctuation">,</span>
    <span class="token literal-property property">type</span><span class="token operator">:</span> <span class="token string">'js'</span><span class="token punctuation">,</span>
    <span class="token literal-property property">usedBytes</span><span class="token operator">:</span> <span class="token number">14967</span><span class="token punctuation">,</span>
    <span class="token literal-property property">totalBytes</span><span class="token operator">:</span> <span class="token number">63261</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token punctuation">{</span>
    <span class="token literal-property property">url</span><span class="token operator">:</span> <span class="token string">'https://www.baidu.com/'</span><span class="token punctuation">,</span>
    <span class="token literal-property property">type</span><span class="token operator">:</span> <span class="token string">'js'</span><span class="token punctuation">,</span>
    <span class="token literal-property property">usedBytes</span><span class="token operator">:</span> <span class="token number">130</span><span class="token punctuation">,</span>
    <span class="token literal-property property">totalBytes</span><span class="token operator">:</span> <span class="token number">131</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token punctuation">{</span>
    <span class="token literal-property property">url</span><span class="token operator">:</span> <span class="token string">'https://dss0.bdstatic.com/5aV1bjqh_Q23odCf/static/superman/js/components/hotsearch-5af0f864cf.js'</span><span class="token punctuation">,</span>
    <span class="token literal-property property">type</span><span class="token operator">:</span> <span class="token string">'js'</span><span class="token punctuation">,</span>
    <span class="token literal-property property">usedBytes</span><span class="token operator">:</span> <span class="token number">1662</span><span class="token punctuation">,</span>
    <span class="token literal-property property">totalBytes</span><span class="token operator">:</span> <span class="token number">5451</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token punctuation">{</span>
    <span class="token literal-property property">url</span><span class="token operator">:</span> <span class="token string">'https://hectorstatic.baidu.com/cd37ed75a9387c5b.js'</span><span class="token punctuation">,</span>
    <span class="token literal-property property">type</span><span class="token operator">:</span> <span class="token string">'js'</span><span class="token punctuation">,</span>
    <span class="token literal-property property">usedBytes</span><span class="token operator">:</span> <span class="token number">51800</span><span class="token punctuation">,</span>
    <span class="token literal-property property">totalBytes</span><span class="token operator">:</span> <span class="token number">75245</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token punctuation">{</span>
    <span class="token literal-property property">url</span><span class="token operator">:</span> <span class="token string">'https://pss.bdstatic.com/r/www/cache/static/protocol/https/plugins/bzPopper_7bc4f0e.js'</span><span class="token punctuation">,</span>
    <span class="token literal-property property">type</span><span class="token operator">:</span> <span class="token string">'js'</span><span class="token punctuation">,</span>
    <span class="token literal-property property">usedBytes</span><span class="token operator">:</span> <span class="token number">23345</span><span class="token punctuation">,</span>
    <span class="token literal-property property">totalBytes</span><span class="token operator">:</span> <span class="token number">92200</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token punctuation">{</span>
    <span class="token literal-property property">url</span><span class="token operator">:</span> <span class="token string">'https://pss.bdstatic.com/r/www/cache/static/protocol/https/home/js/nu_instant_search_79bce6e.js'</span><span class="token punctuation">,</span>
    <span class="token literal-property property">type</span><span class="token operator">:</span> <span class="token string">'js'</span><span class="token punctuation">,</span>
    <span class="token literal-property property">usedBytes</span><span class="token operator">:</span> <span class="token number">1609</span><span class="token punctuation">,</span>
    <span class="token literal-property property">totalBytes</span><span class="token operator">:</span> <span class="token number">24415</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token punctuation">{</span>
    <span class="token literal-property property">url</span><span class="token operator">:</span> <span class="token string">'https://pss.bdstatic.com/r/www/cache/static/protocol/https/plugins/swfobject_0178953.js'</span><span class="token punctuation">,</span>
    <span class="token literal-property property">type</span><span class="token operator">:</span> <span class="token string">'js'</span><span class="token punctuation">,</span>
    <span class="token literal-property property">usedBytes</span><span class="token operator">:</span> <span class="token number">1523</span><span class="token punctuation">,</span>
    <span class="token literal-property property">totalBytes</span><span class="token operator">:</span> <span class="token number">9216</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token punctuation">{</span>
    <span class="token literal-property property">url</span><span class="token operator">:</span> <span class="token string">'https://pss.bdstatic.com/r/www/cache/static/protocol/https/soutu/js/tu_9af35bd.js'</span><span class="token punctuation">,</span>
    <span class="token literal-property property">type</span><span class="token operator">:</span> <span class="token string">'js'</span><span class="token punctuation">,</span>
    <span class="token literal-property property">usedBytes</span><span class="token operator">:</span> <span class="token number">1774</span><span class="token punctuation">,</span>
    <span class="token literal-property property">totalBytes</span><span class="token operator">:</span> <span class="token number">16109</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token punctuation">{</span>
    <span class="token literal-property property">url</span><span class="token operator">:</span> <span class="token string">'https://pss.bdstatic.com/r/www/cache/static/protocol/https/voice/js/voice_7c500f4.js'</span><span class="token punctuation">,</span>
    <span class="token literal-property property">type</span><span class="token operator">:</span> <span class="token string">'js'</span><span class="token punctuation">,</span>
    <span class="token literal-property property">usedBytes</span><span class="token operator">:</span> <span class="token number">7592</span><span class="token punctuation">,</span>
    <span class="token literal-property property">totalBytes</span><span class="token operator">:</span> <span class="token number">33116</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token punctuation">{</span>
    <span class="token literal-property property">url</span><span class="token operator">:</span> <span class="token string">'https://pss.bdstatic.com/r/www/cache/static/protocol/https/amd_modules/@baidu/search-sug_897d083.js'</span><span class="token punctuation">,</span>
    <span class="token literal-property property">type</span><span class="token operator">:</span> <span class="token string">'js'</span><span class="token punctuation">,</span>
    <span class="token literal-property property">usedBytes</span><span class="token operator">:</span> <span class="token number">7066</span><span class="token punctuation">,</span>
    <span class="token literal-property property">totalBytes</span><span class="token operator">:</span> <span class="token number">38737</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token punctuation">{</span>
    <span class="token literal-property property">url</span><span class="token operator">:</span> <span class="token string">'https://hector.baidu.com/a.js'</span><span class="token punctuation">,</span>
    <span class="token literal-property property">type</span><span class="token operator">:</span> <span class="token string">'js'</span><span class="token punctuation">,</span>
    <span class="token literal-property property">usedBytes</span><span class="token operator">:</span> <span class="token number">1832</span><span class="token punctuation">,</span>
    <span class="token literal-property property">totalBytes</span><span class="token operator">:</span> <span class="token number">4665</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token punctuation">{</span>
    <span class="token literal-property property">url</span><span class="token operator">:</span> <span class="token string">'https://www.baidu.com/'</span><span class="token punctuation">,</span>
    <span class="token literal-property property">type</span><span class="token operator">:</span> <span class="token string">'css'</span><span class="token punctuation">,</span>
    <span class="token literal-property property">usedBytes</span><span class="token operator">:</span> <span class="token number">2222</span><span class="token punctuation">,</span>
    <span class="token literal-property property">totalBytes</span><span class="token operator">:</span> <span class="token number">3853</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token punctuation">{</span>
    <span class="token literal-property property">url</span><span class="token operator">:</span> <span class="token string">'https://www.baidu.com/'</span><span class="token punctuation">,</span>
    <span class="token literal-property property">type</span><span class="token operator">:</span> <span class="token string">'css'</span><span class="token punctuation">,</span>
    <span class="token literal-property property">usedBytes</span><span class="token operator">:</span> <span class="token number">118</span><span class="token punctuation">,</span>
    <span class="token literal-property property">totalBytes</span><span class="token operator">:</span> <span class="token number">626</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token punctuation">{</span>
    <span class="token literal-property property">url</span><span class="token operator">:</span> <span class="token string">'https://www.baidu.com/'</span><span class="token punctuation">,</span>
    <span class="token literal-property property">type</span><span class="token operator">:</span> <span class="token string">'css'</span><span class="token punctuation">,</span>
    <span class="token literal-property property">usedBytes</span><span class="token operator">:</span> <span class="token number">0</span><span class="token punctuation">,</span>
    <span class="token literal-property property">totalBytes</span><span class="token operator">:</span> <span class="token number">6423</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token punctuation">{</span>
    <span class="token literal-property property">url</span><span class="token operator">:</span> <span class="token string">'https://www.baidu.com/'</span><span class="token punctuation">,</span>
    <span class="token literal-property property">type</span><span class="token operator">:</span> <span class="token string">'css'</span><span class="token punctuation">,</span>
    <span class="token literal-property property">usedBytes</span><span class="token operator">:</span> <span class="token number">2701</span><span class="token punctuation">,</span>
    <span class="token literal-property property">totalBytes</span><span class="token operator">:</span> <span class="token number">24929</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token punctuation">{</span>
    <span class="token literal-property property">url</span><span class="token operator">:</span> <span class="token string">'https://www.baidu.com/'</span><span class="token punctuation">,</span>
    <span class="token literal-property property">type</span><span class="token operator">:</span> <span class="token string">'css'</span><span class="token punctuation">,</span>
    <span class="token literal-property property">usedBytes</span><span class="token operator">:</span> <span class="token number">0</span><span class="token punctuation">,</span>
    <span class="token literal-property property">totalBytes</span><span class="token operator">:</span> <span class="token number">8599</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token punctuation">{</span>
    <span class="token literal-property property">url</span><span class="token operator">:</span> <span class="token string">'https://www.baidu.com/'</span><span class="token punctuation">,</span>
    <span class="token literal-property property">type</span><span class="token operator">:</span> <span class="token string">'css'</span><span class="token punctuation">,</span>
    <span class="token literal-property property">usedBytes</span><span class="token operator">:</span> <span class="token number">1230</span><span class="token punctuation">,</span>
    <span class="token literal-property property">totalBytes</span><span class="token operator">:</span> <span class="token number">13081</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token punctuation">{</span>
    <span class="token literal-property property">url</span><span class="token operator">:</span> <span class="token string">'https://www.baidu.com/'</span><span class="token punctuation">,</span>
    <span class="token literal-property property">type</span><span class="token operator">:</span> <span class="token string">'css'</span><span class="token punctuation">,</span>
    <span class="token literal-property property">usedBytes</span><span class="token operator">:</span> <span class="token number">4840</span><span class="token punctuation">,</span>
    <span class="token literal-property property">totalBytes</span><span class="token operator">:</span> <span class="token number">40292</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token punctuation">{</span>
    <span class="token literal-property property">url</span><span class="token operator">:</span> <span class="token string">'https://dss0.bdstatic.com/5aV1bjqh_Q23odCf/static/superman/css/ubase_sync-d600f57804.css?v=md5'</span><span class="token punctuation">,</span>
    <span class="token literal-property property">type</span><span class="token operator">:</span> <span class="token string">'css'</span><span class="token punctuation">,</span>
    <span class="token literal-property property">usedBytes</span><span class="token operator">:</span> <span class="token number">0</span><span class="token punctuation">,</span>
    <span class="token literal-property property">totalBytes</span><span class="token operator">:</span> <span class="token number">407</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token punctuation">{</span>
    <span class="token literal-property property">url</span><span class="token operator">:</span> <span class="token string">'https://www.baidu.com/'</span><span class="token punctuation">,</span>
    <span class="token literal-property property">type</span><span class="token operator">:</span> <span class="token string">'css'</span><span class="token punctuation">,</span>
    <span class="token literal-property property">usedBytes</span><span class="token operator">:</span> <span class="token number">9720</span><span class="token punctuation">,</span>
    <span class="token literal-property property">totalBytes</span><span class="token operator">:</span> <span class="token number">16410</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token punctuation">{</span>
    <span class="token literal-property property">url</span><span class="token operator">:</span> <span class="token string">'https://www.baidu.com/'</span><span class="token punctuation">,</span>
    <span class="token literal-property property">type</span><span class="token operator">:</span> <span class="token string">'css'</span><span class="token punctuation">,</span>
    <span class="token literal-property property">usedBytes</span><span class="token operator">:</span> <span class="token number">251</span><span class="token punctuation">,</span>
    <span class="token literal-property property">totalBytes</span><span class="token operator">:</span> <span class="token number">1648</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token punctuation">{</span>
    <span class="token literal-property property">url</span><span class="token operator">:</span> <span class="token string">'https://pss.bdstatic.com/r/www/cache/static/protocol/https/soutu/css/soutu_new2_dd3a84f.css'</span><span class="token punctuation">,</span>
    <span class="token literal-property property">type</span><span class="token operator">:</span> <span class="token string">'css'</span><span class="token punctuation">,</span>
    <span class="token literal-property property">usedBytes</span><span class="token operator">:</span> <span class="token number">1588</span><span class="token punctuation">,</span>
    <span class="token literal-property property">totalBytes</span><span class="token operator">:</span> <span class="token number">13599</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">]</span>
</code></pre></div><p>可以看出，百度首页还有不少可以优化的余地。</p> <h3 id="性能评估"><a href="#性能评估" class="header-anchor">#</a> 性能评估</h3> <p>可以使用Puppeteer评估网站性能，分析页面的加载速度和响应速度等性能指标。</p> <h4 id="_1-评估加载时间"><a href="#_1-评估加载时间" class="header-anchor">#</a> 1. 评估加载时间</h4> <p>页面导航和加载时间等指标，可以通过<code>window.performance</code>访问。</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">const</span> puppeteer <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'puppeteer'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token punctuation">(</span><span class="token keyword">async</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> browser <span class="token operator">=</span> <span class="token keyword">await</span> puppeteer<span class="token punctuation">.</span><span class="token function">launch</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">const</span> page <span class="token operator">=</span> <span class="token keyword">await</span> browser<span class="token punctuation">.</span><span class="token function">newPage</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token keyword">await</span> page<span class="token punctuation">.</span><span class="token function">goto</span><span class="token punctuation">(</span><span class="token string">'https://pptr.dev'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">await</span> page<span class="token punctuation">.</span><span class="token function">waitForSelector</span><span class="token punctuation">(</span><span class="token string">'title'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token comment">// 在页面上下文中执行导航API</span>
  <span class="token keyword">const</span> metrics <span class="token operator">=</span> <span class="token keyword">await</span> page<span class="token punctuation">.</span><span class="token function">evaluate</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token constant">JSON</span><span class="token punctuation">.</span><span class="token function">stringify</span><span class="token punctuation">(</span>window<span class="token punctuation">.</span>performance<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token comment">// 将结果解析为JSON</span>
  console<span class="token punctuation">.</span><span class="token function">info</span><span class="token punctuation">(</span><span class="token constant">JSON</span><span class="token punctuation">.</span><span class="token function">parse</span><span class="token punctuation">(</span>metrics<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token keyword">await</span> browser<span class="token punctuation">.</span><span class="token function">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>现在，通过这些指标(<a href="https://www.w3.org/TR/navigation-timing/#processing-model" target="_blank" rel="noopener noreferrer">指标说明<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>)，就可以计算各种加载时间，例如，<code>loadEventEnd - navigationStart</code>表示从导航开始到页面加载完成的时间。</p> <h4 id="_2-运行时指标"><a href="#_2-运行时指标" class="header-anchor">#</a> 2. 运行时指标</h4> <p>Puppeteer中要获取页面的运行时指标，可以使用<code>page.metrics</code>方法。</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">const</span> puppeteer <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'puppeteer'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token punctuation">(</span><span class="token keyword">async</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> browser <span class="token operator">=</span> <span class="token keyword">await</span> puppeteer<span class="token punctuation">.</span><span class="token function">launch</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">const</span> page <span class="token operator">=</span> <span class="token keyword">await</span> browser<span class="token punctuation">.</span><span class="token function">newPage</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token keyword">await</span> page<span class="token punctuation">.</span><span class="token function">goto</span><span class="token punctuation">(</span><span class="token string">'https://pptr.dev'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">await</span> page<span class="token punctuation">.</span><span class="token function">waitForSelector</span><span class="token punctuation">(</span><span class="token string">'title'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token comment">// 返回页面的运行时指标</span>
  <span class="token keyword">const</span> metrics <span class="token operator">=</span> <span class="token keyword">await</span> page<span class="token punctuation">.</span><span class="token function">metrics</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  console<span class="token punctuation">.</span><span class="token function">info</span><span class="token punctuation">(</span>metrics<span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token keyword">await</span> browser<span class="token punctuation">.</span><span class="token function">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>运行脚本结果是：</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token punctuation">{</span>
  <span class="token literal-property property">Timestamp</span><span class="token operator">:</span> <span class="token number">1327432.660694</span><span class="token punctuation">,</span> <span class="token comment">//调用metrics方法时间戳</span>
  <span class="token literal-property property">Documents</span><span class="token operator">:</span> <span class="token number">17</span><span class="token punctuation">,</span> <span class="token comment">//文档数量</span>
  <span class="token literal-property property">Frames</span><span class="token operator">:</span> <span class="token number">7</span><span class="token punctuation">,</span> <span class="token comment">//frame数量</span>
  <span class="token literal-property property">JSEventListeners</span><span class="token operator">:</span> <span class="token number">61</span><span class="token punctuation">,</span> <span class="token comment">//事件的数量</span>
  <span class="token literal-property property">Nodes</span><span class="token operator">:</span> <span class="token number">2650</span><span class="token punctuation">,</span> <span class="token comment">// DOM元素的数量</span>
  <span class="token literal-property property">LayoutCount</span><span class="token operator">:</span> <span class="token number">10</span><span class="token punctuation">,</span> <span class="token comment">//页面布局的数量</span>
  <span class="token literal-property property">RecalcStyleCount</span><span class="token operator">:</span> <span class="token number">24</span><span class="token punctuation">,</span> <span class="token comment">//页面样式重新计算的次数</span>
  <span class="token literal-property property">LayoutDuration</span><span class="token operator">:</span> <span class="token number">0.145065</span><span class="token punctuation">,</span> <span class="token comment">//所有页面布局的总持续时间</span>
  <span class="token literal-property property">RecalcStyleDuration</span><span class="token operator">:</span> <span class="token number">0.02759</span><span class="token punctuation">,</span> <span class="token comment">//所有页面样式重新计算的总持续时间</span>
  <span class="token literal-property property">ScriptDuration</span><span class="token operator">:</span> <span class="token number">0.425575</span><span class="token punctuation">,</span> <span class="token comment">// JavaScript执行的总时间</span>
  <span class="token literal-property property">TaskDuration</span><span class="token operator">:</span> <span class="token number">0.744677</span><span class="token punctuation">,</span> <span class="token comment">//浏览器执行的所有任务的总持续时间</span>
  <span class="token literal-property property">JSHeapUsedSize</span><span class="token operator">:</span> <span class="token number">16177616</span><span class="token punctuation">,</span> <span class="token comment">// JavaScript实际内存使用情况</span>
  <span class="token literal-property property">JSHeapTotalSize</span><span class="token operator">:</span> <span class="token number">22986752</span>  <span class="token comment">// JavaScript使用的内存总量，包括空闲分配的空间</span>
<span class="token punctuation">}</span>
</code></pre></div><h4 id="_3-通过chrome跟踪分析浏览器活动"><a href="#_3-通过chrome跟踪分析浏览器活动" class="header-anchor">#</a> 3. 通过Chrome跟踪分析浏览器活动</h4> <p>Chrome跟踪是一种分析工具，记录浏览器的幕后活动，包括浏览器中线程、选项卡和进程等相关信息。Chrome跟踪获取的信息可在Chrome DevTools的时间轴面板中查看。</p> <p>Puppeteer中，要使用Chrome跟踪功能，可以使用<code>page.tracing</code>对象。</p> <p>下面的例子，记录浏览器在导航过程中的活动:</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">const</span> puppeteer <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'puppeteer'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token punctuation">(</span><span class="token keyword">async</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> browser <span class="token operator">=</span> <span class="token keyword">await</span> puppeteer<span class="token punctuation">.</span><span class="token function">launch</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">const</span> page <span class="token operator">=</span> <span class="token keyword">await</span> browser<span class="token punctuation">.</span><span class="token function">newPage</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token comment">// 开始跟踪</span>
  <span class="token keyword">await</span> page<span class="token punctuation">.</span>tracing<span class="token punctuation">.</span><span class="token function">start</span><span class="token punctuation">(</span><span class="token punctuation">{</span> <span class="token literal-property property">path</span><span class="token operator">:</span> <span class="token string">'trace.json'</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token keyword">await</span> page<span class="token punctuation">.</span><span class="token function">goto</span><span class="token punctuation">(</span><span class="token string">'https://www.qikegu.com'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">await</span> page<span class="token punctuation">.</span><span class="token function">waitForSelector</span><span class="token punctuation">(</span><span class="token string">'title'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token comment">// 结束跟踪</span>
  <span class="token keyword">await</span> page<span class="token punctuation">.</span>tracing<span class="token punctuation">.</span><span class="token function">stop</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token keyword">await</span> browser<span class="token punctuation">.</span><span class="token function">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>运行脚本，跟踪记录会保存为<code>trace.json</code>文件</p> <p>可在Chrome DevTools的时间轴面板中查看跟踪信息：使用chrome浏览器打开网址<code>chrome://tracing</code>，然后加载<code>trace.json</code>文件。</p> <p>下面是将跟踪文件导入DevTools后的图形化数据:</p> <img src="https://qiniu.wanggege.cn/blog/puppeteer/t1.png" class="zoom-custom-imgs"> <p>参考文章</p> <p><a href="https://www.qikegu.com/docs/4525" target="_blank" rel="noopener noreferrer">Puppeteer 教程<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p></div> <footer class="page-edit"><!----> <div class="last-updated"><span class="prefix">更新时间:</span> <span class="time">2022年12月20日星期二上午10点30分</span></div></footer> <div class="page-nav"><p class="inner"><span class="prev">
      ←
      <a href="/myBlog/node/pm2.html" class="prev">
        PM2 命令使用方法
      </a></span> <span class="next"><a href="/myBlog/npm/nrm.html">
        nrm 管理npm源
      </a>
      →
    </span></p></div> </main></div><div class="global-ui"><div class="back-to-top" style="display:none;" data-v-994ac33a data-v-994ac33a><div class="back-top-container top" data-v-994ac33a><img src="/myBlog/assets/img/lufei.5fe3de8f.png" alt="路飞" title="点我返回顶部" class="diglett top" data-v-994ac33a></div></div><!----></div></div>
    <script src="/myBlog/assets/js/app.4ba5bfaa.js" defer></script><script src="/myBlog/assets/js/3.553f6c3a.js" defer></script><script src="/myBlog/assets/js/2.383a70a7.js" defer></script><script src="/myBlog/assets/js/80.c5e95066.js" defer></script><script src="/myBlog/assets/js/9.8651d337.js" defer></script>
  </body>
</html>
